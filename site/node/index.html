


<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lehrmaterial, Übungen, Aufgaben und Hilfen für WebTech">
      
      
        <link rel="canonical" href="http://freiheit.f4.htw-berlin.de/webtech/node/">
      
      
        <meta name="author" content="Jörn Freiheit">
      
      <link rel="shortcut icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>Node.js - WebTech</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#757575">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="" data-md-color-primary="grey" data-md-color-accent="indigo">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nodejs" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="">
    <a href="http://freiheit.f4.htw-berlin.de/webtech" title="WebTech" class="md-header-nav__button md-logo" aria-label="WebTech">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            WebTech
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Node.js
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suchbegriff eingeben
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/jfreiheit/webtech/" title="Quellcode" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="http://freiheit.f4.htw-berlin.de/webtech" title="WebTech" class="md-nav__button md-logo" aria-label="WebTech">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    WebTech
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jfreiheit/webtech/" title="Quellcode" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../uebungen/" title="Übungen" class="md-nav__link">
      Übungen
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tools/" title="Werkzeuge" class="md-nav__link">
      Werkzeuge
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../html/" title="HTML" class="md-nav__link">
      HTML
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../css/" title="CSS" class="md-nav__link">
      CSS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rwd/" title="RWD" class="md-nav__link">
      RWD
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../json/" title="JSON" class="md-nav__link">
      JSON
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../angular/" title="Angular" class="md-nav__link">
      Angular
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../material/" title="Material" class="md-nav__link">
      Material
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../backend/" title="REST-API" class="md-nav__link">
      REST-API
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../backendanbindung/" title="Frontend-Backend-Anbindung" class="md-nav__link">
      Frontend-Backend-Anbindung
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Node.js
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Node.js" class="md-nav__link md-nav__link--active">
      Node.js
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#der-erste-eigene-webserver" class="md-nav__link">
    Der erste eigene Webserver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eine-erweiterung-der-antwort" class="md-nav__link">
    Eine Erweiterung der Antwort
  </a>
  
    <nav class="md-nav" aria-label="Eine Erweiterung der Antwort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#template-string" class="md-nav__link">
    Template-String
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls-auswerten" class="md-nav__link">
    URLs auswerten
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chrome-developer-tools" class="md-nav__link">
    Chrome Developer Tools
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#express" class="md-nav__link">
    Express
  </a>
  
    <nav class="md-nav" aria-label="Express">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#router" class="md-nav__link">
    Router
  </a>
  
    <nav class="md-nav" aria-label="Router">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-view-controller" class="md-nav__link">
    Model-View-Controller
  </a>
  
    <nav class="md-nav" aria-label="Model-View-Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    View
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anbindung-von-datenbanken" class="md-nav__link">
    Anbindung von Datenbanken
  </a>
  
    <nav class="md-nav" aria-label="Anbindung von Datenbanken">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eine-movie-datenbank" class="md-nav__link">
    Eine Movie-Datenbank
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unser-backend-als-reiner-rest-server" class="md-nav__link">
    Unser Backend als reiner REST-Server
  </a>
  
    <nav class="md-nav" aria-label="Unser Backend als reiner REST-Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-type-und-fehlerbehandlung" class="md-nav__link">
    Content-Type und Fehlerbehandlung
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-einen-neuen-datensatz-anlegen" class="md-nav__link">
    POST - einen neuen Datensatz anlegen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-einen-datensatz-andern" class="md-nav__link">
    PUT - einen Datensatz ändern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-einen-datensatz-andern" class="md-nav__link">
    DELETE - einen Datensatz ändern
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-web-tokens-zur-authentifizierung" class="md-nav__link">
    JSON Web Tokens zur Authentifizierung
  </a>
  
    <nav class="md-nav" aria-label="JSON Web Tokens zur Authentifizierung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datenbank-und-model" class="md-nav__link">
    Datenbank und Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erzeugen-eines-jwt" class="md-nav__link">
    Erzeugen eines JWT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../books/" title="Bücher-App" class="md-nav__link">
      Bücher-App
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../books-backend/" title="Bücher-Backend" class="md-nav__link">
      Bücher-Backend
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#der-erste-eigene-webserver" class="md-nav__link">
    Der erste eigene Webserver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eine-erweiterung-der-antwort" class="md-nav__link">
    Eine Erweiterung der Antwort
  </a>
  
    <nav class="md-nav" aria-label="Eine Erweiterung der Antwort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#template-string" class="md-nav__link">
    Template-String
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls-auswerten" class="md-nav__link">
    URLs auswerten
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chrome-developer-tools" class="md-nav__link">
    Chrome Developer Tools
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#express" class="md-nav__link">
    Express
  </a>
  
    <nav class="md-nav" aria-label="Express">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    Response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#router" class="md-nav__link">
    Router
  </a>
  
    <nav class="md-nav" aria-label="Router">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-view-controller" class="md-nav__link">
    Model-View-Controller
  </a>
  
    <nav class="md-nav" aria-label="Model-View-Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    View
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anbindung-von-datenbanken" class="md-nav__link">
    Anbindung von Datenbanken
  </a>
  
    <nav class="md-nav" aria-label="Anbindung von Datenbanken">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eine-movie-datenbank" class="md-nav__link">
    Eine Movie-Datenbank
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unser-backend-als-reiner-rest-server" class="md-nav__link">
    Unser Backend als reiner REST-Server
  </a>
  
    <nav class="md-nav" aria-label="Unser Backend als reiner REST-Server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content-type-und-fehlerbehandlung" class="md-nav__link">
    Content-Type und Fehlerbehandlung
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-einen-neuen-datensatz-anlegen" class="md-nav__link">
    POST - einen neuen Datensatz anlegen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-einen-datensatz-andern" class="md-nav__link">
    PUT - einen Datensatz ändern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-einen-datensatz-andern" class="md-nav__link">
    DELETE - einen Datensatz ändern
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-web-tokens-zur-authentifizierung" class="md-nav__link">
    JSON Web Tokens zur Authentifizierung
  </a>
  
    <nav class="md-nav" aria-label="JSON Web Tokens zur Authentifizierung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datenbank-und-model" class="md-nav__link">
    Datenbank und Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erzeugen-eines-jwt" class="md-nav__link">
    Erzeugen eines JWT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jfreiheit/webtech/edit/master/docs/node.md" title="Seite editieren" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="nodejs">Node.js<a class="headerlink" href="#nodejs" title="Permanent link">&para;</a></h1>
<p>Viele der folgenden Beispiele sind dem <a href="https://www.rheinwerk-verlag.de/nodejs_4630/">Buch</a></p>
<blockquote>
<p>Sebastian Springer:
"Node.js. Das umfassende Handbuch"
3., aktualisierte und erweiterte Auflage 2018, Rheinwerk Computing, ISBN 978-3-8362-6255-2 <a href="https://www.rheinwerk-verlag.de/nodejs_4630/">Link</a></p>
</blockquote>
<p>entnommen (und nur unwesentlich geändert).</p>
<p><img alt="Node.js" src="../files/35_nodeBuch.jpg" /></p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>Installationsanweisungen für Ihr Betriebssystem finden Sie auf der Node.js-Webseite <a href="https://nodejs.org">https://nodejs.org/</a>. Nach der Installation können Sie überprüfen, ob node erfolgreich installiert wurde. Geben Sie dazu im Terminal</p>
<div class="highlight"><pre><span></span><code>node -v
</code></pre></div>

<p>ein. Es sollte die Versionsnummer erscheinen, z.B. <code>v13.3.0</code>.</p>
<p>Da es sich bei JavaScript um eine Skriptsprache handelt, kann jede Anweisung durch den Interpreter interpretiert und ausgeführt werden. Deshalb lässt sich Node.js auch als im interaktiven Modus auf der Kommandozeile testen. Geben Sie dazu im Terminal </p>
<div class="highlight"><pre><span></span><code>node 
</code></pre></div>

<p>ein. Es erscheint etwas in der Art</p>
<div class="highlight"><pre><span></span><code>Welcome to Node.js v13.3.0.
Type &quot;.help&quot; for more information.
&gt; 
</code></pre></div>

<p>Node.js befindet sich dann im <em>Read-Eval-Print-Loop (REPL)</em>. Die im Terminal eingegebenen Kommandos werden gelesen (<em>read</em>), evaluiert (<em>eval</em>), ausgegeben (<em>print</em>) und auf das nächste Kommando gewartet (<em>loop</em>). Geben Sie im Terminal </p>
<div class="highlight"><pre><span></span><code>console.log(&quot;Hello FIW!&quot;);
</code></pre></div>

<p>ein. Es erscheint</p>
<div class="highlight"><pre><span></span><code>Hello FIW!
undefined
</code></pre></div>

<p>Sie verlassen REPL durch Eingabe von <code>.exit</code>.</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Somit ist Node.js installiert.</p>
</div>
<h2 id="der-erste-eigene-webserver">Der erste eigene Webserver<a class="headerlink" href="#der-erste-eigene-webserver" title="Permanent link">&para;</a></h2>
<p>Wir verwenden Node.js, um einen Webserver zu implementieren. Insbesondere wird dieser Webserver Anfragen (<em>requests</em>) unserer Webanwendung (des Clients) empfangen und verarbeiten. Die Verarbeitung wird meistens ein Zugriff auf eine Datenbank sein. Als Antwort (<em>response</em>) wird der Webserver die angefragten Daten an unsere Anwendung zurücksenden. </p>
<p>Wir werden nun unseren ersten einfachen Webserver mithilfe von Node.js implementieren. Erstellen Sie sich in Ihrem <code>workspace</code> ein Verzeichnis <code>backend</code> und darin eine Datei <code>server.js</code> (das kann natürlich alles auch anders heißen). Öffnen Sie die Datei mit Ihrer IDE und geben Sie folgendes ein:</p>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">server.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/plain; charset=utf-8&#39;</span><span class="p">});</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;FIW!\n&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server is listening to http://localhost:8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Wechseln Sie im Terminal in Ihr <code>backend</code>-Verzeichnis. Darin befindet sich die <code>server.js</code>. Geben Sie ein:</p>
<div class="highlight"><pre><span></span><code>node server.js
</code></pre></div>

<p>Sie erhalten die Ausgabe <code>Server is listening to http://localhost:8080</code>. </p>
<div class="admonition fail">
<p class="admonition-title">Port bereits belegt</p>
<p>Sollten Sie den Fehler <code>Error: listen EADDRINUSE:::8080</code> erhalten, so ist der Port <code>8080</code> bei Ihnen bereits durch eine andere Anwendung belegt. Dann wählen Sie einen anderen Port, z.B. <code>8081</code>. </p>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Ihr Webserver läuft nun!</p>
</div>
<p>Dies können wir auf verschiedene Arten testen:</p>
<ol>
<li>Geben Sie <code>http://localhost:8080</code> in Ihren Browser ein. Es erscheint <code>Hello FIW!</code> im Browser. </li>
<li>Nutzen Sie <a href="./tools/#curl"><code>curl</code></a> und geben Sie im Terminal <code>curl http://localhost:8080</code> ein. Es erscheint <code>Hello FIW!</code> im Terminal. </li>
<li>Nutzen Sie <a href="./tools/#postman">'Postman'</a> und geben Sie in das Eingabefeld neben <code>GET</code> die URL <code>http://localhost:8080</code> ein und klicken auf <code>Send</code>. Es erscheint <code>Hello FIW!</code> im unteren Teil des Fensters (Reiter <code>Body</code>).</li>
</ol>
<p>Der Webserver läuft nun so lange, bis wir ihn beenden. Wir betrachten das obige Listing im Detail. In Zeilennummer 1 wird das <a href="https://nodejs.org/api/http.html"><code>http</code>-Modul von Node.js</a> geladen und der Variablen <code>http</code> zugewiesen. Das Laden von Modulen erfolgt in Node.js mithilfe der Funktion <code>require()</code>. In Zeilennummer 3 wird ein Webserver mithilfe des <code>http</code>-Moduls erzeugt (<code>createServer()</code>). Das <code>http</code>-Modul bietet auch die Möglichkeit, einen Client zu erzeugen - aber das machen wir nicht mit Node.js sondern mit Angular. In Zeile 9 geben wir an, dass der Webserver nun permanent am Port <code>8080</code> auf Anfragen <em>lauschen</em> soll. Als 2. Parameter der <code>listen()</code>-Funktion hätte auch ein <code>HOST</code> angegeben werden können, also die IP-Adresse des Webservers. Wird keine IP-Adresse angegeben, so wie hier, ist es in unserem Fall <code>localhost</code>. Dann folgt eine <a href="./javascript/#callback-funktionen"><em>Callback</em>-Funktion</a>, die einen String auf die Konsole ausgibt, sobald die Verbindung steht. In den Zeilen 4 bis 6 ist die Antwort (<em>response</em>) des Webservers auf eine Anfrage (<em>request</em>) des Clients definiert. Die Funktion, die diese Antwort erstellt, ist eine Callback-Funktion der <code>createServer</code>-Funktion (in Zeile 3). Diese Callback-Funktion besitzt die beiden Parameter <code>request</code> und <code>response</code>. In diesem ersten Beispiel wird nur eine Response definiert. Diese besteht aus einem <em>HTTP-Header</em> (<code>writeHead()</code>) und einem <em>HTTP-Body</em> (<code>write()</code> + <code>end()</code>). Die Funktion <code>writeHead()</code>, die den HTTP-Header erzeugt, besitzt 2 Parameter. Der erste Parameter ist der <a href="https://developer.mozilla.org/de/docs/Web/HTTP/Status">HTTP-Status-Code</a>. Der Status-Code <code>200</code> besagt, dass die Anfrage (<em>request</em>) vom Server empfangen wurde und die Antwort (<em>response</em>) in dieser Nachricht enthalten ist. Der eigentliche HTTP-Header wird mit dem zweiten Parameter übertragen. In diesem Fall übermittelt der Server dem Client die Informationen, dass es sich bei der Antwort um reinen Text handelt (<code>content-type:text-plain</code>) und dass der HTTP-Body unter Verwendung des Zeichensatzes <a href="https://www.ionos.de/digitalguide/websites/webseiten-erstellen/utf-8-codierung-globaler-digitaler-kommunikation/">UTF-8</a> (<code>charset=utf-8</code>) kodiert ist. Der HTTP-Body wird mit der <code>write()</code>-Funktion übertragen und mit der <code>end()</code>-Funktion abgeschlossen. In diesem Fall besteht der Body aus der Zeichenkette <code>Hello FIW!</code>. </p>
<h2 id="eine-erweiterung-der-antwort">Eine Erweiterung der Antwort<a class="headerlink" href="#eine-erweiterung-der-antwort" title="Permanent link">&para;</a></h2>
<p>Im obigen Beispiel bestand die Antwort aus reinem Text. Wir erweitern die Antwort nun und senden vom Webserver an den Client als Body eine vollständige HTML-Seite.</p>
<div class="tabbed-set" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">server.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html; charset=utf-8&#39;</span><span class="p">});</span>

    <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="sb">`&lt;!DOCTYPE html&gt;</span>
<span class="sb">      &lt;html&gt;</span>
<span class="sb">        &lt;head&gt;</span>
<span class="sb">          &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="sb">          &lt;title&gt;WebTech - Node.js&lt;/title&gt;</span>
<span class="sb">        &lt;/head&gt;</span>
<span class="sb">        &lt;body&gt;</span>
<span class="sb">          &lt;h1 style=&quot;color:#76B900&quot;&gt;Hello FIW!&lt;/h1&gt;</span>
<span class="sb">        &lt;/body&gt;</span>
<span class="sb">      &lt;/html&gt;`</span><span class="p">;</span>

    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server is listening to http://localhost:8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Achten Sie darauf, dass der <code>content-type</code> nun <code>text/html</code> ist, nicht mehr <code>text/plain</code> (Zeile 4). Sollte Ihr Server aus dem vorherigen Beispiel noch laufen, so müssen Sie ihn zunächst beenden. Geben Sie im Termina zum Beenden des Prozesses <code>node server.js</code> einfach <code>Strg+C</code> (<code>Ctrl+C</code>) und sarten Sie den Server unter Eingabe von</p>
<div class="highlight"><pre><span></span><code>node server.js
</code></pre></div>

<p>erneut. Rufen Sie im Browser <code>http://localhost:8080/</code> auf. Es erscheint</p>
<p><img alt="server.js" src="../files/28_node.png" /></p>
<p>Sie können ja auch mal den <code>content-type</code> erneut auf <code>text/plain</code> setzen und den Server erneut starten (1. <code>Ctrl+C</code> und 2. <code>node server.js</code>), um zu sehen, welche Bedeutung die Angabe des <code>content-type</code> hat.</p>
<h3 id="template-string">Template-String<a class="headerlink" href="#template-string" title="Permanent link">&para;</a></h3>
<p>Im obigen Beispiel ist der String <code>body</code> in Backtick-Zeichen &#96; eingeschlossen. Das nennt man <em>Template-String</em> und ermöglicht mithilfe von <code>${}</code> Ausdrücke bzw. Variablen auszuwerten. Im Folgenden ist eine solche Verwendung einer Variable gezeigt. </p>
<div class="tabbed-set" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">Template-String</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html; charset=utf-8&#39;</span><span class="p">});</span>

    <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;FIW!&#39;</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="sb">`&lt;!DOCTYPE html&gt;</span>
<span class="sb">      &lt;html&gt;</span>
<span class="sb">        &lt;head&gt;</span>
<span class="sb">          &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="sb">          &lt;title&gt;WebTech - Node.js&lt;/title&gt;</span>
<span class="sb">        &lt;/head&gt;</span>
<span class="sb">        &lt;body&gt;</span>
<span class="sb">          &lt;h1 style=&quot;color:#76B900&quot;&gt;Hello </span><span class="si">${</span> <span class="nx">name</span> <span class="si">}</span><span class="sb">&lt;/h1&gt;</span>
<span class="sb">        &lt;/body&gt;</span>
<span class="sb">      &lt;/html&gt;`</span><span class="p">;</span>

    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server is listening to http://localhost:8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>In Zeile 6 wird eine Variable <code>name</code> definiert, der der String <code>FIW!</code> zugewiesen wird. In Zeile 14 wird mithilfe von <code>${ name }</code> der Wert der Variable <code>name</code> in das HTML eingebunden, so dass der Inhalt der Überschrift <code>&lt;h1&gt;</code> zu <code>Hello FIW!</code> ausgewertet wird.</p>
<h3 id="urls-auswerten">URLs auswerten<a class="headerlink" href="#urls-auswerten" title="Permanent link">&para;</a></h3>
<p>Eine URL kann um Schlüssel-Werte-Paare (<em>Parameter</em>) erweitert werden, um Daten mit der URL an den Webserver zu senden (siehe <a href="./html/#urls"><strong>HTML &rarr; URLs</strong></a>). Ein Schlüssel-Werte-Paar wird immer durch ein <code>=</code> verbunden:</p>
<div class="highlight"><pre><span></span><code><span class="nv">key</span><span class="o">=</span>value
</code></pre></div>

<p>Das erste Schlüssel-Werte-Paar wird hinter ein <code>?</code> an die URL gehängt. Jedes weitere Paar wird mit einem <code>&amp;</code> angebunden:</p>
<div class="highlight"><pre><span></span><code>http://www.example.org/?key1<span class="o">=</span>value1<span class="p">&amp;</span><span class="nv">key2</span><span class="o">=</span>value2<span class="p">&amp;</span><span class="nv">key3</span><span class="o">=</span>value3
</code></pre></div>

<p>Wir werden jetzt diese Parameter auswerten. Dazu laden wir einerseits ein weiteres Modul, nämlich das <code>url</code>-Modul und wir werten die Anfrage (<em>request</em>) dahingehend aus, dass wir die Parameter der URL auswerten. </p>
<div class="tabbed-set" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">server.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">url</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html; charset=utf-8&#39;</span><span class="p">});</span>

    <span class="kr">const</span> <span class="nx">parsedUrl</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">parsedUrl</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>

    <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="sb">`&lt;!DOCTYPE html&gt;</span>
<span class="sb">          &lt;html&gt;</span>
<span class="sb">        &lt;head&gt;</span>
<span class="sb">          &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="sb">          &lt;title&gt;WebTech - Node.js&lt;/title&gt;</span>
<span class="sb">        &lt;/head&gt;</span>
<span class="sb">        &lt;body&gt;</span>
<span class="sb">          &lt;h1 style=&quot;color:#76B900&quot;&gt;Hello </span><span class="si">${</span> <span class="nx">params</span><span class="p">.</span><span class="nx">name</span> <span class="si">}</span><span class="sb"> in </span><span class="si">${</span> <span class="nx">params</span><span class="p">.</span><span class="nx">ort</span> <span class="si">}</span><span class="sb">&lt;/h1&gt;</span>
<span class="sb">        &lt;/body&gt;</span>
<span class="sb">      &lt;/html&gt;`</span><span class="p">;</span>

    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server is listening to http://localhost:8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Nach dem restart des Webservers (1. <code>Ctrl+C</code> und 2. <code>node server.js</code>) und der Eingabe folgender URL: <code>http://localhost:8080/?name=FIW&amp;ort=Berlin</code> wird im Browser Folgendes angezeigt:</p>
<p><img alt="Node.js" src="../files/29_node.png" /></p>
<h3 id="chrome-developer-tools">Chrome Developer Tools<a class="headerlink" href="#chrome-developer-tools" title="Permanent link">&para;</a></h3>
<p>Die <a href="./tools/#chrome">Chrome Developer Tools</a> können auch zum Debuggen von Node.js-Anwendungen verwendet werden. Rufen Sie dafür Ihre Node.js-Anwendung im Terminal mit dem <code>--inspect</code>-Flag auf:</p>
<div class="highlight"><pre><span></span><code>node --inspect server.js
</code></pre></div>

<p>Im Terminal erscheint eine Ausgabe in der Form:</p>
<div class="highlight"><pre><span></span><code>Debugger listening on ws://127.0.0.1:9229/dc995a6a-61eb-4143-af7e-ac8e4599dcd7
For help, see: https://nodejs.org/en/docs/inspector
Server is listening to http://localhost:8080
</code></pre></div>

<p>Im Chrome-Browser können Sie nun einerseits wie gewohnt die URL <code>http://localhost:8080/?name=FIW&amp;ort=Berlin</code> eingeben, aber das Debuggen kann unter Eingabe der URL <code>chrome://inspect/</code> erfolgen. Es erscheint folgende Seite im Browser: </p>
<p><img alt="Debug" src="../files/30_debug.png" /></p>
<p>Für weitere Informationen zum Debuggen siehe z.B. <a href="https://nodejs.org/en/docs/guides/debugging-getting-started/">https://nodejs.org/en/docs/guides/debugging-getting-started/</a>.</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Wir haben mithilfe von Node.js einen ersten eigenen Webserver erstellt. Wir haben uns mit dem Konzept von Request und Response vertraut gemacht und eine eigene Response erstellt. Wir haben Argumente aus der URL ausgelesen und somit dynamisch unsere Response angepasst. Wir wollen nun zunächst ein Framework kennenlernen, das uns manche Arbeiten erleichtert: Express. </p>
</div>
<h2 id="express">Express<a class="headerlink" href="#express" title="Permanent link">&para;</a></h2>
<p><a href="https://expressjs.com/de/">Express</a> ist ein Node.js-Framework, das einerseits recht einfach gehalten wurde, andererseits aber alle wesentlichen Funktionen für eine Web-Anwendung bereithält. So müssen wir uns beispielsweise bei der Verwendung von Express nicht mehr selbst um das Parsen der URL kümmern. Wir werden im Folgenden ein kleines Projekt zu Verwaltung von Filmen erstellen. Dies geschieht mithilfe von <a href="https://www.npmjs.com/"><code>npm</code></a>. <code>npm</code> ist der <em>Node package manager</em>. Bisher enthält unser Ordner <code>backend</code> nur die Datei <code>server.js</code>. Das ist jedoch insofern noch kein wirkliches Node.js-Projekt, da es noch nicht vom Paketmanager, also <code>npm</code> verwaltet wird. Um dies zu tun wechseln wir in den Ordner <code>backend</code> und initialisieren dann unser Node.js-Projekt:</p>
<div class="tabbed-set" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><label for="__tabbed_5_1">im Ordner backend</label><div class="tabbed-content"></div>
</div>
<div class="highlight"><pre><span></span><code>npm init
</code></pre></div>

<p>Sie werden nun einige Sachen gefragt und können eigentlich immer jeweils mit <code>Enter</code> bestätigen. Es erfolgt also ungefähr ein solcher Dialog im Terminal:</p>
<div class="highlight"><pre><span></span><code>% npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

See <span class="sb">`</span>npm <span class="nb">help</span> init<span class="sb">`</span> <span class="k">for</span> definitive documentation on these fields
and exactly what they <span class="k">do</span>.

Use <span class="sb">`</span>npm install &lt;pkg&gt;<span class="sb">`</span> afterwards to install a package and
save it as a dependency in the package.json file.

Press ^C at any <span class="nb">time</span> to quit.
package name: <span class="o">(</span>backend<span class="o">)</span> backend
version: <span class="o">(</span><span class="m">1</span>.0.0<span class="o">)</span> 
description: Node.js-Backend
entry point: <span class="o">(</span>server.js<span class="o">)</span> 
<span class="nb">test</span> command: 
git repository: 
keywords: 
author: 
license: <span class="o">(</span>ISC<span class="o">)</span> 
About to write to /Users/jornfreiheit/workspace/backend/package.json:

<span class="o">{</span>
  <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;backend&quot;</span>,
  <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;1.0.0&quot;</span>,
  <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;Node.js-Backend&quot;</span>,
  <span class="s2">&quot;main&quot;</span>: <span class="s2">&quot;server.js&quot;</span>,
  <span class="s2">&quot;scripts&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;test&quot;</span>: <span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,
    <span class="s2">&quot;start&quot;</span>: <span class="s2">&quot;node server.js&quot;</span>
  <span class="o">}</span>,
  <span class="s2">&quot;author&quot;</span>: <span class="s2">&quot;&quot;</span>,
  <span class="s2">&quot;license&quot;</span>: <span class="s2">&quot;ISC&quot;</span>
<span class="o">}</span>


Is this OK? <span class="o">(</span>yes<span class="o">)</span> 
</code></pre></div>

<p>Das wesentliche Ergebnis der Initialisierung ist die Erstellung der <code>package.json</code>-Datei. Darin können wir Paketabhängigkeiten definieren. Außerdem ist in dem Ordner <code>backend</code> ein Unterordner <code>node_modules</code> entstanden, der die Node.js-Module enthält, die wir benötigen. </p>
<p>Als erstes installieren wir Express:</p>
<div class="highlight"><pre><span></span><code>npm install express
</code></pre></div>

<p>Nun bauen wir uns eine kleine <code>index.js</code>-Datei, die unsere erste Express-Anwendung darstellt. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;My first express application&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server listening on port 8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

<p>In Zeile <code>1</code> wird das Express-Paket eingebunden. In Zeile <code>2</code> wird eine Express-App mit Basiskonfiguration erzeugt (hier ein <code>app</code>-Objekt). Die <code>get()</code>-Funktion des <code>app</code>-Objektes erzeugt eine Route, über die man sich mit dem Browser mit der App verbinden kann (Zeilen <code>4</code>-<code>6</code>). Als Response (<code>res</code>) wird einfach eine Zeichenkette gesendet (<code>send</code>). In den Zeilen <code>8</code>-<code>10</code> wird die App an den Port <code>8080</code> gebunden. Hier erfolgt intern die Erstellung eines Node.js-Servers mit <code>http</code>-Modul. Wenn Sie nun </p>
<div class="highlight"><pre><span></span><code>node index.js
</code></pre></div>

<p>innerhalb des <code>backend</code>-Ordners aufrufen, wird der Node.js-Server erstellt und Sie können im Browser unter der URL <code>localhost:8080</code> darauf zugreifen. Es erscheint:</p>
<p><img alt="express" src="../files/33_express.png" /></p>
<p>Im obigen Beispiel erkennt man in Zeile <code>4</code> zwei Parameter der Routing-Callback-Funktion innerhalb der <code>app.get()</code>-Methode: das <code>Request</code>-Objekt <code>req</code> und das <code>Response</code>-Objekt <code>res</code>. Beide Objekte gehören zu den elementaren Elementen einer Applikation. </p>
<h3 id="request">Request<a class="headerlink" href="#request" title="Permanent link">&para;</a></h3>
<p>Die Eigenschaften des <code>Request</code>-Objektes <code>req</code> sind in <a href="https://expressjs.com/de/api.html#req">https://expressjs.com/de/api.html#req</a> erläutert. Hier folgt eine kurze unvollständige Auflistung:</p>
<table>
<thead>
<tr>
<th><strong>Eigenschaft</strong></th>
<th><strong>Bedeutung</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>method</code></td>
<td>HTTP-Methode, mit der die Anfrage gesendet wurde (z.B. GET oder POST)</td>
</tr>
<tr>
<td><code>originalUrl</code></td>
<td>enthält die Anfrage-URL</td>
</tr>
<tr>
<td><code>params</code></td>
<td>enthält die variablen Anteile der Anfrage-URL</td>
</tr>
<tr>
<td><code>protocol</code></td>
<td>enthält das Protokoll der Anfrage (z.B. http oder https)</td>
</tr>
<tr>
<td><code>query</code></td>
<td>ist ein Objekt, das alle Parameter der Anfrage-URL enthält</td>
</tr>
</tbody>
</table>
<h3 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h3>
<p>Die Eigenschaften des <code>Response</code>-Objektes <code>res</code> sind in <a href="https://expressjs.com/de/api.html#res">https://expressjs.com/de/api.html#res</a> erläutert. Hier folgt eine kurze unvollständige Auflistung:</p>
<table>
<thead>
<tr>
<th><strong>Methode</strong></th>
<th><strong>Bedeutung</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get(field)</code></td>
<td>gibt den Response-Header von <code>field</code> zurück (z.B. <code>get('Content-Type')</code>)</td>
</tr>
<tr>
<td><code>set(field[,value])</code></td>
<td>setzt den Wert des angegebenen Header-Feldes</td>
</tr>
<tr>
<td><code>json([body])</code></td>
<td>sendet eine JSON-Response (<code>[body]</code> ist das JSON-Objekt)</td>
</tr>
<tr>
<td><code>cookie(name,value[,options])</code></td>
<td>setzt einen Cookie-Wert <code>name=value</code></td>
</tr>
<tr>
<td><code>redirect([status,]path)</code></td>
<td>Weiterleitung der Anfrage nach <code>path</code></td>
</tr>
<tr>
<td><code>status(code)</code></td>
<td>setzt den Status der Antwort auf <code>code</code></td>
</tr>
<tr>
<td><code>send([body])</code></td>
<td>sendet die HTTP-Antwort</td>
</tr>
<tr>
<td><code>end([data][,encoding])</code></td>
<td>beendet den Antwortprozess</td>
</tr>
</tbody>
</table>
<h2 id="router">Router<a class="headerlink" href="#router" title="Permanent link">&para;</a></h2>
<p>Wie man der <a href="https://expressjs.com/de/api.html">API-Dokumentation von Express</a> entnehmen kann, sind die Grundelemente einer Express-Anwendung</p>
<ul>
<li>die <a href="https://expressjs.com/de/api.html#express"><code>express()</code>-Funktion</a>, die die Express-Anwendung erstellt,</li>
<li>die <a href="https://expressjs.com/de/api.html#app">Eigenschaften und Methoden</a>, die dieser Anwendung zur Verfügung stehen,</li>
<li>das <a href="https://expressjs.com/de/api.html#req"><code>Request</code>-Objekt</a>,</li>
<li>das <a href="https://expressjs.com/de/api.html#res"><code>Response</code>-Objekt</a> sowie</li>
<li>der <a href="https://expressjs.com/de/api.html#router"><code>Router</code></a>.</li>
</ul>
<p>Mit Letzterem beschäftigen wir uns jetzt. Unser Projekt soll folgende Struktur aufweisen:</p>
<div class="highlight"><pre><span></span><code>backend
+---- movie
|     +---- model.js
|     +---- view.js
|     +---- controller.js
|     +---- movierouter.js
+---- node_modules
+---- index.js
+---- package.json
</code></pre></div>

<p><code>backend</code>, <code>movie</code> und <code>node_modules</code> sind jeweils Ordner. <code>node_modules</code> wurde automatisch erzeugt (durch <code>npm init</code> und enthält alle eingebundenen Node.js-Pakete). Wir erstellen zunächst die Datei <code>movie/movierouter.js</code><sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> und "specken" die <code>index.js</code> etwas ab (die <code>get()</code>-Funktion wird gelöscht). </p>
<div class="tabbed-set" data-tabs="6:3"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><label for="__tabbed_6_1">movie/movierouter.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span> <span class="cm">/* siehe Reiter &quot;const data&quot; */</span>  <span class="p">];</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><label for="__tabbed_6_2">index.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server listening on port 8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><label for="__tabbed_6_3">const data</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die Verurteilten&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Pate&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1972&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Pate 2&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1974&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;The Dark Knight&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2008&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die zwölf Geschworenen&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1957&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Schindlers Liste&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1993&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die Rückkehr des Königs&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2003&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Pulp Fiction&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Zwei glorreiche Halunken&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1966&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Fight Club&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1999&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die Gefährten&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2001&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Forrest Gump&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Inception&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2010&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Das Imperium schlägt zurück&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1980&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die zwei Türme&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2002&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Matrix&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1999&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">17</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;GoodFellas – Drei Jahrzehnte in der Mafia&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1990&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Einer flog über das Kuckucksnest&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1975&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">19</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Joker&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2019&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die sieben Samurai&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1954&#39;</span> <span class="p">},</span>
<span class="p">];</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Beachten Sie, dass in den obigen Listings aus Gründen der Übersichtlichkeit in der <code>movie/movierouter.js</code> das JSON-Objekt herausgelöscht und im Reiter "const data" zur Verfügung gestellt wurde (muss dann hineinkopiert werden).</p>
<p>In der <code>movie/movierouter.js</code> wird das <code>Router</code>-Objekt, das in Zeile <code>2</code> erzeugt wird, in Zeile <code>10</code> exportiert. Im Folgenden wird gezeigt, wie der <code>Router</code> nun in unsere Anwendung eingebunden wird. Dies passiert in der <code>index.js</code>. Die hinzugefügten Zeilen sind markiert. </p>
<div class="tabbed-set" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><label for="__tabbed_7_1">index.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="hll"><span class="kr">const</span> <span class="nx">movieRouter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./movie/movierouter&#39;</span><span class="p">);</span>
</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/movie&#39;</span><span class="p">));</span>
</span>
<span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/movie&#39;</span><span class="p">,</span> <span class="nx">movieRouter</span><span class="p">);</span>
</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server listening on port 8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Beim Laden des Moduls wird die <code>.js</code>-Endung nicht mit angegeben. Das heißt, der Router wird aus der <code>movie/movierouter.js</code>-Datei mittels <code>require('./movie/movierouter')</code> geladen (siehe Zeile <code>2</code>). Wäre der Router sogar in einer Datei <code>movie/index.js</code>, müsste dieser Name nicht angegeben werden, es würde also genügen, den Router über den Pfad <code>/movie</code> zu laden (entspricht also <code>/movie/index</code>). Die <code>use()</code>-Methode in Zeile <code>8</code> gibt an, dass der <code>movieRouter</code> (aus <code>movie/index.js</code>) für das Routing des Pfades <strong>url</strong><code>/movie</code> zuständig ist. Die <code>get()</code>-Methode aus Zeile <code>6</code> sorgt dafür, dass der Aufruf <strong>url</strong><code>/</code> (also z.B. <code>localhost:8080</code>) nach <strong>url</strong><code>/movie</code> (also z.B. <code>localhost:8080/movie</code>) weitergeleitet wird. </p>
<p>Rufen Sie nun im <code>backend</code>-Ordner </p>
<div class="highlight"><pre><span></span><code>node index.js
</code></pre></div>

<p>auf und geben Sie im Browser <code>localhost:8080</code> ein. Beobachten Sie, dass auf die URL <code>localhost:8080/movie</code> weitergeleitet wird. Es erscheint im Browser (entweder <code>parsed</code> oder <code>raw</code> - Abhängig von Browser und Browser-Plugins):</p>
<p><img alt="movie" src="../files/34_movie.png" /></p>
<h3 id="model-view-controller">Model-View-Controller<a class="headerlink" href="#model-view-controller" title="Permanent link">&para;</a></h3>
<p>Bis jetzt steckt alles im Router (<code>/movie/movierouter.js</code>). Wir werden im ersten Schritt die Daten (die eigentlich zum Model gehören) und eine Aktion (<code>listAction</code>) im Controller (<code>movie/controller.js</code>) definieren. </p>
<div class="tabbed-set" data-tabs="8:3"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><label for="__tabbed_8_1">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span> <span class="cm">/* siehe Reiter &quot;const data&quot; */</span>  <span class="p">];</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><label for="__tabbed_8_2">movie/movierouter.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="hll"><span class="kr">const</span> <span class="p">{</span> <span class="nx">listAction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>
</span>
<span class="hll"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">listAction</span><span class="p">);</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_8_3" name="__tabbed_8" type="radio" /><label for="__tabbed_8_3">const data</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die Verurteilten&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Pate&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1972&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Pate 2&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1974&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;The Dark Knight&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2008&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die zwölf Geschworenen&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1957&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Schindlers Liste&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1993&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die Rückkehr des Königs&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2003&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Pulp Fiction&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Zwei glorreiche Halunken&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1966&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Fight Club&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1999&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die Gefährten&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2001&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Forrest Gump&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Inception&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2010&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Das Imperium schlägt zurück&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1980&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die zwei Türme&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2002&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Matrix&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1999&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">17</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;GoodFellas – Drei Jahrzehnte in der Mafia&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1990&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Einer flog über das Kuckucksnest&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1975&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">19</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Joker&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2019&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die sieben Samurai&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1954&#39;</span> <span class="p">},</span>
<span class="p">];</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<h4 id="controller">Controller<a class="headerlink" href="#controller" title="Permanent link">&para;</a></h4>
<p>Der Controller verwaltet perspektivisch die View und das Model. Beides haben wir jetzt noch nicht. Zunächst wird im Controller eine Aktion <code>listAction</code> definiert, die alle Daten in einer Response (<code>response.send(data)</code>) sendet<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>. Diese Aktion wird mittels <code>exports</code> anderen Modulen zur Verfügung gestellt.</p>
<p>Der Router (<code>movierouter.js</code>) wurde entsprechend angepasst. Einerseits haben wir die Daten aus dem Router entfernt, andererseits enthält die <code>get()</code>-Methode nun nicht mehr die direkte Implementierung (die ja in den Controller ausgelagert wurde), sondern ruft die Methode <code>listAction</code> des Controllers auf. Dazu muss sie eingebunden werden. Dies würde normalerweise wie folgt geschehen:</p>
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">controller</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">listAction</span> <span class="o">=</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">listAction</span><span class="p">;</span>
</code></pre></div>

<p>Da ein solches Konstrukt häufig vorkommt, wurde ein sogenanntes <em>destructuring</em> eingeführt. Obiger Code wird mithilfe von <em>destructuring</em> durch </p>
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">listAction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>
</code></pre></div>

<p>ersetzt und verzichtet somit auf die Hilfsvariable <code>controller</code>. Die Eigenschaft, die im Controller <code>listAction</code> heißt (und importiert wird), wird direkt geladen.</p>
<h4 id="model">Model<a class="headerlink" href="#model" title="Permanent link">&para;</a></h4>
<p>Das Model (<code>movie/model.js</code>) verwaltet die Daten. Dazu werden wir zunächst die Daten aus dem Controller in das Model verschieben. Außerdem stellt das Model eine Funktion (<code>getAll()</code>) zum Auslesen aller Daten zur Verfügung:</p>
<div class="tabbed-set" data-tabs="9:3"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><label for="__tabbed_9_1">movie/model.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span> <span class="cm">/* siehe Reiter &quot;const data&quot; */</span> <span class="p">];</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><label for="__tabbed_9_2">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">getAll</span><span class="p">());</span>
</span><span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_9_3" name="__tabbed_9" type="radio" /><label for="__tabbed_9_3">const data</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die Verurteilten&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Pate&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1972&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Pate 2&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1974&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;The Dark Knight&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2008&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die zwölf Geschworenen&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1957&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Schindlers Liste&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1993&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die Rückkehr des Königs&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2003&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Pulp Fiction&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Zwei glorreiche Halunken&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1966&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Fight Club&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1999&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die Gefährten&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2001&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Forrest Gump&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1994&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Inception&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2010&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Das Imperium schlägt zurück&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1980&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Der Herr der Ringe: Die zwei Türme&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2002&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Matrix&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1999&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">17</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;GoodFellas – Drei Jahrzehnte in der Mafia&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1990&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Einer flog über das Kuckucksnest&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1975&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">19</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Joker&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;2019&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Die sieben Samurai&#39;</span><span class="p">,</span> <span class="nx">year</span><span class="o">:</span> <span class="s1">&#39;1954&#39;</span> <span class="p">},</span>
<span class="p">];</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Die Funktion <code>getAll()</code> im Model (<code>movie/model.js</code>) wird jetzt direkt dort implementiert, wo sie auch exportiert wird. Die Implementierung hätte man auch auf eine Variable legen können (wie <code>listAction</code> beim Controller) und dann exportieren.</p>
<p>Der Controller (<code>movie/controller.js</code>) liest das Model ein (Zeile <code>1</code>) und verwendet die <code>getAll()</code>-Funktion, um die Daten zu senden (Zeile <code>4</code>).</p>
<h3 id="view">View<a class="headerlink" href="#view" title="Permanent link">&para;</a></h3>
<p>Die View ist für die Darstellung verantwortlich. Später wird diese von uns in Angular umgesetzt. Hier wird es nur zur Verdeutlichung gezeigt. Wir verwenden JavaScript-Template-Strings (sozusagen eine Mischung aus JavaScript und HTML). Wer möchte, kann diesen Abschnitt auch überspringen, da wir später unsere Oberfläche viel aufwendiger mit Angular gestalten.</p>
<div class="tabbed-set" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><label for="__tabbed_10_1">movie/view.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">movies</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sb">`</span>
<span class="sb">  &lt;!DOCTYPE html&gt;</span>
<span class="sb">  &lt;html lang=&quot;de&quot;&gt;</span>
<span class="sb">    &lt;head&gt;</span>
<span class="sb">        &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="sb">        &lt;title&gt;Movie-list&lt;/title&gt;</span>
<span class="sb">    &lt;/head&gt;</span>
<span class="sb">    &lt;body&gt;</span>
<span class="sb">        &lt;table&gt;</span>
<span class="sb">            &lt;thead&gt;</span>
<span class="sb">                &lt;tr&gt;</span>
<span class="sb">                    &lt;th&gt;Id&lt;/th&gt;</span>
<span class="sb">                    &lt;th&gt;Title&lt;/th&gt;</span>
<span class="sb">                &lt;/tr&gt;</span>
<span class="sb">            &lt;/thead&gt;</span>
<span class="sb">            &lt;tbody&gt;</span>
<span class="sb">              </span><span class="si">${</span><span class="nx">movies</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">movie</span> <span class="p">=&gt;</span> <span class="sb">`&lt;tr&gt;&lt;td&gt;</span><span class="si">${</span><span class="nx">movie</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">&lt;/td&gt; &lt;td&gt;</span><span class="si">${</span><span class="nx">movie</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">&lt;/td&gt;&lt;/tr&gt;`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb"></span>
<span class="sb">            &lt;/tbody&gt;</span>
<span class="sb">        &lt;/table&gt;</span>
<span class="sb">    &lt;/body&gt;</span>
<span class="sb">  &lt;/html&gt;</span>
<span class="sb">  `</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><label for="__tabbed_10_2">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>
<span class="hll"><span class="kr">const</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./view&#39;</span><span class="p">);</span>
</span>
<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="kr">const</span> <span class="nx">movies</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">getAll</span><span class="p">();</span>
</span><span class="hll">    <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">view</span><span class="p">(</span><span class="nx">movies</span><span class="p">);</span>
</span><span class="hll">    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
</span><span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>In der View (<code>movie/view.js</code>) wird also eine HTML-Tabelle (<code>&lt;table&gt;</code>) erzeugt. Der Funktion <code>render</code> werden die anzuzeigenden Daten als JSON-Array übergeben. Die JavaScript-Funktion <code>map()</code> durchläuft jeden einzelnen Eintrag des Arrays und speichert ihn jeweils in die Variable <code>movie</code>. Jeder <code>movie</code> wird in einer Tabllenzeile (<code>&lt;tr&gt;</code>) dargestellt und besteht aus einer <code>id</code> und einem <code>title</code> (siehe <code>const data</code> im Model). Auf diese Elemente wird zugegriffen und in einzelnen Dateneinträgen der Tabelle (<code>&lt;td&gt;</code>) dargestellt. Die JavaScript-Funktion <code>join()</code> verbindet diese Struktur zu einem String (Konkatenation mit <code>''</code>), so dass der Template-String tatsächlich ein String ist.</p>
<p>Im Controller (<code>movie/controller.js</code>) wird die View eingebunden (Zeile <code>2</code>) und dieser View die Movie-Daten übergeben, so dass <code>body</code> dann den durch <code>movie.render()</code> erzeugten String enthält (die HTML-Seite). Dieser wird als Response gesendet.</p>
<p>Nach einem Neustart der Anwendung (<code>node index.js</code> im Ordner <code>backend</code>) erscheint im Browser (<code>localhost:8080</code>) folgende Seite:</p>
<p><img alt="Movies" src="../files/36_movies.png" /></p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Wir haben mit Express das bekannteste Node.js-Framework verwendet, um die Verarbeitung von Daten im Rahmen des Model-View-Controller-Konzeptes umzusetzen. Im obigen Beispiel haben wir die Daten (die Filme) direkt im JSON-Format im Model gespeichert. Das ist natürlich nicht flexibel. Wir werden die Daten nun in eine Datenbank auslagern.</p>
</div>
<h2 id="anbindung-von-datenbanken">Anbindung von Datenbanken<a class="headerlink" href="#anbindung-von-datenbanken" title="Permanent link">&para;</a></h2>
<p>Wir wollen Node.js hauptsächlich dafür verwenden, im Backend mit einer Datenbank zu kommunizieren. Wir wollen dies hier exemplarisch mit MySQL (siehe <a href="./tools/#mysql"><strong>Werkzeuge &rarr; MySQL</strong></a>) erläutern. Die Verwendung von z.B. PostgreSQL ist äquivelent - Sie benötigen nur einen anderen Datenbanktreiber. </p>
<p>Wir werden zunächst das Node.js-Paket, das den <code>mysql</code>-Treiber enthält, installieren:</p>
<div class="highlight"><pre><span></span><code>npm install mysql
</code></pre></div>

<p>Danach ist in der <code>package.json</code> die Abhängigkeit vom <code>mysql</code>-Paket hinterlegt (siehe <code>"dependencies"</code>):</p>
<div class="tabbed-set" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><label for="__tabbed_11_1">package.json</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;backend&quot;</span><span class="p">,</span>
  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Node.js-Backend for MySQL&quot;</span><span class="p">,</span>
  <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="s2">&quot;server.js&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;node server.js&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;author&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="s2">&quot;license&quot;</span><span class="o">:</span> <span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
  <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mysql&quot;</span><span class="o">:</span> <span class="s2">&quot;^2.18.1&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</div>
</div>
<h3 id="eine-movie-datenbank">Eine Movie-Datenbank<a class="headerlink" href="#eine-movie-datenbank" title="Permanent link">&para;</a></h3>
<p>Wir werden die Anbindung von Datenbanken exemplarisch an der <code>Movie</code>-Datenbank zeigen, die wir bereits im obigen <a href="./#express"><strong>Express</strong></a>-Abschnitt verwendet haben. Dazu erstellen wir uns eine Datenbank namens <code>movie-db</code> und befüllen diese mit einigen Filmen (Tabelle <code>Movie</code>). Sie können diese Datenbak auf verschiedenen Wegen erstellen. Am einfachsten ist es, wenn Sie <a href="https://www.phpmyadmin.net/"><code>phpMyadmin</code></a> verwenden. Dort können Sie folgende SQL-Anfrage im Reiter <code>SQL</code> eingeben (Sie können auch im Terminal <code>SQL</code>-Anfragen eingeben nachdem Sie sich dort per <code>mysql -u root -p</code> mit dem MySQL-Server verbunden haben):</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="o">`</span><span class="n">movie</span><span class="o">-</span><span class="n">db</span><span class="o">`</span><span class="p">;</span>

<span class="n">USE</span> <span class="o">`</span><span class="n">movie</span><span class="o">-</span><span class="n">db</span><span class="o">`</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">Movies</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">title</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="k">year</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">Movies</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">title</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="k">year</span><span class="o">`</span><span class="p">)</span> <span class="k">VALUES</span> 
<span class="p">(</span><span class="s1">&#39;Die Verurteilten&#39;</span><span class="p">,</span> <span class="s1">&#39;1994&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Der Pate&#39;</span><span class="p">,</span> <span class="s1">&#39;1972&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Der Pate 2&#39;</span><span class="p">,</span> <span class="s1">&#39;1974&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;The Dark Knight&#39;</span><span class="p">,</span> <span class="s1">&#39;2008&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Die zwölf Geschworenen&#39;</span><span class="p">,</span> <span class="s1">&#39;1957&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Schindlers Liste&#39;</span><span class="p">,</span> <span class="s1">&#39;1993&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Der Herr der Ringe: Die Rückkehr des Königs&#39;</span><span class="p">,</span> <span class="s1">&#39;2003&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Pulp Fiction&#39;</span><span class="p">,</span> <span class="s1">&#39;1994&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Zwei glorreiche Halunken&#39;</span><span class="p">,</span> <span class="s1">&#39;1966&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Fight Club&#39;</span><span class="p">,</span> <span class="s1">&#39;1999&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Der Herr der Ringe: Die Gefährten&#39;</span><span class="p">,</span> <span class="s1">&#39;2001&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Forrest Gump&#39;</span><span class="p">,</span> <span class="s1">&#39;1994&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Inception&#39;</span><span class="p">,</span> <span class="s1">&#39;2010&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Das Imperium schlägt zurück&#39;</span><span class="p">,</span> <span class="s1">&#39;1980&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Der Herr der Ringe: Die zwei Türme&#39;</span><span class="p">,</span> <span class="s1">&#39;2002&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;1999&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;GoodFellas – Drei Jahrzehnte in der Mafia&#39;</span><span class="p">,</span> <span class="s1">&#39;1990&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Einer flog über das Kuckucksnest&#39;</span><span class="p">,</span> <span class="s1">&#39;1975&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Joker&#39;</span><span class="p">,</span> <span class="s1">&#39;2019&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Die sieben Samurai&#39;</span><span class="p">,</span> <span class="s1">&#39;1954&#39;</span><span class="p">);</span>
</code></pre></div>

<p>Wir verwenden das Projekt, das wir bereits im obigen <a href="./#express"><strong>Express</strong></a>-Abschnitt verwendet haben, also die Dateien aus <code>backend</code>:</p>
<div class="highlight"><pre><span></span><code>backend
+---- movie
|     +---- model.js
|     +---- view.js
|     +---- controller.js
|     +---- movierouter.js
+---- node_modules
+---- index.js
+---- package.json
</code></pre></div>

<p>Zunächst ändern wir die <code>movie/model.js</code>. Darin werden nun nicht mehr die Daten gehalten, sondern die Verbindung zur Datenbank aufgebaut. Außerdem sehen wir 4 Funktionen zur Datenverwaltung vor, wovon wir eine (<code>getAll()</code>) gleich implementieren<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>:</p>
<div class="tabbed-set" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><label for="__tabbed_12_1">movie/model.js</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>   <span class="cm">/* hier muss Ihr Passwort hin */</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s1">&#39;movie-db&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM Movies&#39;</span><span class="p">;</span>
        <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="k">else</span>      <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAll</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>

</div>
<input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><label for="__tabbed_12_2">movie/controller.js</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./view&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span>
        <span class="nx">movies</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">view</span><span class="p">(</span><span class="nx">movies</span><span class="p">));</span>
        <span class="p">},</span>
        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>

    <span class="p">);</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>

</div>
</div>
<p>Im Model (<code>/movie/model.js</code>) wird zunächst die Verbindung zur Datenbank aufgebaut (Zeilen <code>2-7</code> und <code>connection.connect()</code>). Die <code>getAll()</code>-Funktion stellt mithilfe von <code>connection.query()</code> eine Anfrage an die Datenbank (erster Parameter der <code>connection.query()</code>-Funktion). In unserem Beispiel ist die Anfrage die SQL-Query <code>SELECT * FROM Movies</code>.</p>
<p>Die <code>getAll()</code>-Funktion gibt ein <code>Promise</code>-Objekt zurück. Promises werden in <a href="./javascript/#promises"><strong>JavaScript&rarr;Promises</strong></a> erläutert. </p>
<p>Im Controller (<code>/movie/controller.js</code>) wird das <code>Promise</code>-Objekt in der <code>then</code>-Funktion ausgewertet. Wird in der Promise die <code>resolve</code>-Methode aufgerufen, werden die <code>results</code> übergeben, also das Ergebnis der Datenbankanfrage. Diese Werte werden in der ersten Callback-Funktion der <code>then</code>-Methode dem Parameter <code>movies</code> übergeben. Soll nur das JSON gesendet werden, wird die <code>view</code> nicht benötigt (statt <code>response.send(view(movies));</code> genügt dann <code>response.send(movies);</code>). Hier kapselt die <code>View</code> die Daten noch in einen HTML-Template-String. </p>
<p>Im Falle eines Fehlers ruft die Promise die <code>reject</code>-Funktion auf und übergibt den Parameter <code>error</code>. Diese Funktion ruft dann in der <code>then</code>-Funktion die zweite Callback-Funktion für die Fehlerauswertung auf. </p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Wir haben jetzt eine MySQL-datenbank angebunden und die Anbindung anhand einer <code>getAll()</code>-Funktion, die alle in der Datenbank gespeicherten Filme zurückgibt, gezeigt. Wir haben somit einen lesenden Zugriff auf alle Datenbankeinträge realisiert. Im folgenden werden wir auch weitere Zugriffe (create, update, delete) umsetzen. Allerdings haben wir bisher auch eine View mithilfe von Node.js erstellt und verwendet. Die Idee im folgenden ist, dass unser Backend nicht mehr für die Darstellung zuständig ist, sondern die Ergebnisse der Datenbankabfragen im JSON-Format zurückgibt. Unser mit Angular erstelltes Frontend soll für die Darstellung zuständig sein. Wir stellen unser Backend vollständig auf das REST-Konzept um. </p>
</div>
<h3 id="unser-backend-als-reiner-rest-server">Unser Backend als reiner REST-Server<a class="headerlink" href="#unser-backend-als-reiner-rest-server" title="Permanent link">&para;</a></h3>
<p><em>Representional State Transfer (REST)</em> ist ein Architekturkonzept und wird in vielen Webanwendungen verwendet. REST beschreibt die Schnittstelle zwischen Frontend und Backend und ist dabei sehr stark an HTTP angelehnt:</p>
<ul>
<li>jede Ressource wird über eine eindeutige URL aufgerufen (z.B. alle Filme über <code>localhost:8080/movies</code>, den Film mit der <code>id=3</code> über <code>localhost:8080/movie/3</code>)</li>
<li>es wird definiert, mit welcher HTTP-Anfrage auf die Ressource zugegriffen wird (z.B. <code>get</code> zum Lesen, <code>post</code> zum Anlegen, <code>put</code> zum Ändern von Ressourcen)</li>
<li>jede Anfrage ist zustandslos, d.h. eine Anfrage muss alle notwendigen Informationen beinhalten und frühere Anfragen (und deren Responses) werden nicht gespeichert</li>
</ul>
<p>Wir werden unsere View im Backend von nun an also nicht mehr benötigen. Unser Projekt sieht derzeit so aus:</p>
<div class="tabbed-set" data-tabs="13:4"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><label for="__tabbed_13_1">index.js</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">movieRouter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./movie/movierouter&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/movie&#39;</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/movie&#39;</span><span class="p">,</span> <span class="nx">movieRouter</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server listening on port 8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

</div>
<input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><label for="__tabbed_13_2">movie/model.js</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>   <span class="cm">/* hier muss Ihr Passwort hin */</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s1">&#39;movie-db&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM Movies&#39;</span><span class="p">;</span>
        <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="k">else</span>      <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAll</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>

</div>
<input id="__tabbed_13_3" name="__tabbed_13" type="radio" /><label for="__tabbed_13_3">movie/controller.js</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span>
        <span class="nx">movies</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">movies</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>

    <span class="p">);</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>

</div>
<input id="__tabbed_13_4" name="__tabbed_13" type="radio" /><label for="__tabbed_13_4">movie/movierouter.js</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">listAction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">listAction</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>

</div>
</div>
<p>Geben wir also die die URL <code>localhost:8080</code> an, dann passiert folgendes:</p>
<ul>
<li>die Route wird weitergeleitet an <code>localhost:8080/movie</code> (siehe in <code>index.js</code> die Anweisung <code>app.get('/', (req, res) =&gt; res.redirect('/movie'));</code>)</li>
<li>dadurch wird der <code>movie/movierouter.js</code> aufgerufen und dieser ruft die Funktion <code>listAction</code> auf</li>
<li><code>listAction</code> ruft die Promise auf, die in der Funktion <code>model.getAll()</code> definiert wird</li>
<li>in <code>getAll()</code> erfolgt eine Anfrage an die Datenbank</li>
<li>wird diese Anfrage erfolgreich ausgeführt, ruft die Promise die <code>resolve</code>-Funktion auf und übergibt alle Resultate der Anfrage</li>
<li>in <code>listAction</code> werden diese Resultate als Resonse gesendet</li>
</ul>
<p>Wir rufen Postman zum Testen dieser Anfrage auf und geben <code>localhost:8080</code> in das URL-Feld ein und senden die Anfrage mittels <code>GET</code>-Methode ab. Es erscheint:</p>
<p><img alt="Postman" src="../files/37_postman_all.png" /></p>
<p>Das gleiche Ergebnis bekommen wir, wenn wir als URL <code>localhost:8080/movie</code> eingeben (darauf wird ja eh umgeleitet). Wir können die Ausgabe auch mithilfe von <code>curl</code> testen:</p>
<div class="highlight"><pre><span></span><code>% curl http://localhost:8080/movie
<span class="o">[{</span><span class="s2">&quot;id&quot;</span>:1,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Die Verurteilten&quot;</span>,<span class="s2">&quot;year&quot;</span>:1994<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:2,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Der Pate&quot;</span>,<span class="s2">&quot;year&quot;</span>:1972<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:3,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Der Pate 2&quot;</span>,<span class="s2">&quot;year&quot;</span>:1974<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:4,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;The Dark Knight&quot;</span>,<span class="s2">&quot;year&quot;</span>:2008<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:5,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Die zwölf Geschworenen&quot;</span>,<span class="s2">&quot;year&quot;</span>:1957<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:6,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Schindlers Liste&quot;</span>,<span class="s2">&quot;year&quot;</span>:1993<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:7,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Der Herr der Ringe: Die Rückkehr des Königs&quot;</span>,<span class="s2">&quot;year&quot;</span>:2003<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:8,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Pulp Fiction&quot;</span>,<span class="s2">&quot;year&quot;</span>:1994<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:9,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Zwei glorreiche Halunken&quot;</span>,<span class="s2">&quot;year&quot;</span>:1966<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:10,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Fight Club&quot;</span>,<span class="s2">&quot;year&quot;</span>:1999<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:11,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Der Herr der Ringe: Die Gefährten&quot;</span>,<span class="s2">&quot;year&quot;</span>:2001<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:12,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Forrest Gump&quot;</span>,<span class="s2">&quot;year&quot;</span>:1994<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:13,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Inception&quot;</span>,<span class="s2">&quot;year&quot;</span>:2010<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:14,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Das Imperium schlägt zurück&quot;</span>,<span class="s2">&quot;year&quot;</span>:1980<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:15,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Der Herr der Ringe: Die zwei Türme&quot;</span>,<span class="s2">&quot;year&quot;</span>:2002<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:16,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Matrix&quot;</span>,<span class="s2">&quot;year&quot;</span>:1999<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:17,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;GoodFellas – Drei Jahrzehnte in der Mafia&quot;</span>,<span class="s2">&quot;year&quot;</span>:1990<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:18,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Einer flog über das Kuckucksnest&quot;</span>,<span class="s2">&quot;year&quot;</span>:1975<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:19,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Joker&quot;</span>,<span class="s2">&quot;year&quot;</span>:2019<span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:20,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Die sieben Samurai&quot;</span>,<span class="s2">&quot;year&quot;</span>:1954<span class="o">}]</span>
</code></pre></div>

<p>Wir erweitern unsere Schnittstelle zunächst um die Ansicht eines einzelnen Films. Wir wollen nun mit der URL <code>http://localhost:8080/movie/3</code> den Film angezeigt bekommen, der die <code>id</code> 3 hat. Wir wollen also die URLs um die Angabe einer <code>id</code> erweitern und für diesen Endpunkt den entsprechenden Film zurückgesendet bekommen. </p>
<p>Dazu erweitern wir (untem im Listing jeweils gelb markiert)</p>
<ul>
<li>die <code>movie/model.js</code> um eine Funktion <code>getOne(id)</code>; das Model stellt nach außen die Funktion <code>get(id)</code> zur Verfügung, die als Response den Film sendet, der die entsprechende <code>id</code> hat,</li>
<li>die <code>movie/controller.js</code> um eine Funktion <code>detailAction()</code>, die den Parameter <code>id</code> aus der URL ausliest und die Funktion <code>model.get(id)</code> aufruft,</li>
<li>den <code>movie/movierouter.js</code> um eine weitere Route, nämlich <code>router.get('/:id', detailAction);</code>, so dass eine <code>id</code> an die URL gehängt werden kann und für diesen Fall die <code>detailAction</code> aufgerufen wird</li>
</ul>
<div class="tabbed-set" data-tabs="14:3"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><label for="__tabbed_14_1">movie/model.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>   <span class="cm">/* hier muss Ihr Passwort hin */</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s1">&#39;movie-db&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM Movies&#39;</span><span class="p">;</span>
        <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="k">else</span>      <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="hll"><span class="kd">function</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">        <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM Movies WHERE id=?&#39;</span><span class="p">;</span>
</span><span class="hll">        <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class="hll">            <span class="k">else</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class="hll">        <span class="p">});</span>
</span><span class="hll">    <span class="p">});</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAll</span><span class="p">,</span>
<span class="hll">    <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)},</span>
</span><span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><label for="__tabbed_14_2">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span>
        <span class="nx">movies</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">movies</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>

    <span class="p">);</span>
<span class="p">}</span>

<span class="hll"><span class="kd">function</span> <span class="nx">detailAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span>
</span><span class="hll">        <span class="nx">movie</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">movie</span><span class="p">),</span>
</span><span class="hll">        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>
</span><span class="hll">    <span class="p">);</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
<span class="hll">    <span class="nx">detailAction</span><span class="p">,</span>
</span><span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_14_3" name="__tabbed_14" type="radio" /><label for="__tabbed_14_3">movie/movierouter.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="hll"><span class="kr">const</span> <span class="p">{</span> <span class="nx">listAction</span><span class="p">,</span> <span class="nx">detailAction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>
</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">listAction</span><span class="p">);</span>
<span class="hll"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="nx">detailAction</span><span class="p">);</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<h4 id="content-type-und-fehlerbehandlung">Content-Type und Fehlerbehandlung<a class="headerlink" href="#content-type-und-fehlerbehandlung" title="Permanent link">&para;</a></h4>
<p>Zwar senden wir bereits die Resultate der Requests als JSON zurück, jedoch ist der <code>content-type</code> unserer Response noch <code>content-type:text/html</code>, da wir die Response mithilfe der <code>send()</code>-Funktion senden (<code>response.send()</code>). Wir ändern dies in <code>response.json()</code>. Dadurch teilen wir dem Client mit, dass der gesendetete <code>content-type</code> ein JSON ist (<code>content-type:application/json</code>).</p>
<p>Für eine erfolgreiche Bearbeitung eines Requests wird mit der Response der HTTP-Statuscode 200 gesendet. Für den Fehlerfall wollen wir nun dafür sorgen, dass der HTTP-Statuscode <a href="https://developer.mozilla.org/de/docs/Web/HTTP/Status/500#:~:text=Der%20HTTP%20500%20Internal%20Server,ist%20ein%20generisches%20%22Auffangbecken%22.">500 - Internal Server Error</a> übertragen wird. Dies erreichen wir im Fehlerfall mit <code>error =&gt; response.status(500).json(error)</code>. Unser Controller sieht nun also so aus:</p>
<div class="tabbed-set" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><label for="__tabbed_15_1">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span>
        <span class="nx">movies</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="hll">            <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">movies</span><span class="p">);</span>
</span>        <span class="p">},</span>
<span class="hll">        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>
</span>    <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">detailAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span>
<span class="hll">        <span class="nx">movie</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">movie</span><span class="p">),</span>
</span><span class="hll">        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>
</span>    <span class="p">);</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
    <span class="nx">detailAction</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<h4 id="post-einen-neuen-datensatz-anlegen">POST - einen neuen Datensatz anlegen<a class="headerlink" href="#post-einen-neuen-datensatz-anlegen" title="Permanent link">&para;</a></h4>
<p>Um einen neuen Datensatz anzulegen, müssen wir zwei Dinge beachten:</p>
<ul>
<li>die HTTP-Anfrage ist <code>POST</code> (anstelle von <code>GET</code>, das wir zum Lesen verwenden)</li>
<li>der Request übergibt im Body den neuen Datensatz (als JSON) &rarr; dazu benötigen wir das Paket <code>body-parser</code> von Node.js und nutzen davon die <code>json()</code>-Funktion zum Einlesen des neuen Datensatzes im JSON-Format</li>
</ul>
<p>Wir passen zunächst die <code>index.js</code> entsprechend an:</p>
<div class="tabbed-set" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><label for="__tabbed_16_1">index.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="hll"><span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>
</span><span class="kr">const</span> <span class="nx">movieRouter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./movie/movierouter&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/movie&#39;</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/movie&#39;</span><span class="p">,</span> <span class="nx">movieRouter</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server listening on port 8080&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Um nun einen neuen Datensatz in der Datenbank anzulegen, erweitern wir unser Projekt wie folgt:</p>
<ul>
<li>in <code>movie/model.js</code> wird eine <code>insert()</code>-Funktion definiert, welche durch eine <code>save()</code>-Funktion aufgerufen wird (<code>save()</code> wird nach außen zur Verfügung gestellt<sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup>),</li>
<li>in <code>movie/controller.js</code> wird eine <code>createAction()</code> definiert, die den neuen Datensatz aus dem <code>request,body</code> ausliest und die <code>model.save()</code> aufruft,</li>
<li>in <code>movie/movierouter.js</code> wird der neue Endpunkt <code>router.post('/', createAction);</code> festgelegt</li>
</ul>
<div class="tabbed-set" data-tabs="17:3"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><label for="__tabbed_17_1">movie/model.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>   <span class="cm">/* hier muss Ihr Passwort hin */</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s1">&#39;movie-db&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>

<span class="hll"><span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">        <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;INSERT INTO Movies (title, year) VALUES (?, ?)&#39;</span><span class="p">;</span>
</span><span class="hll">        <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">[</span><span class="nx">movie</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">year</span><span class="p">],</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class="hll">            <span class="k">else</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
</span><span class="hll">        <span class="p">});</span>
</span><span class="hll">    <span class="p">});</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAll</span><span class="p">,</span>
    <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)},</span>
<span class="hll">    <span class="nx">save</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">movie</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">movie</span><span class="p">);</span>
</span><span class="hll">    <span class="p">},</span>
</span><span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><label for="__tabbed_17_2">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>  
<span class="kd">function</span> <span class="nx">detailAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>  

<span class="hll"><span class="kd">function</span> <span class="nx">createAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="kr">const</span> <span class="nx">movie</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">id</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">title</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">year</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span>
</span><span class="hll">    <span class="p">};</span>
</span><span class="hll">    <span class="nx">model</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">movie</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span>
</span><span class="hll">        <span class="nx">newMovie</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">newMovie</span><span class="p">),</span>
</span><span class="hll">        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>
</span><span class="hll">    <span class="p">);</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
    <span class="nx">detailAction</span><span class="p">,</span>
<span class="hll">    <span class="nx">createAction</span><span class="p">,</span>
</span><span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_17_3" name="__tabbed_17" type="radio" /><label for="__tabbed_17_3">movie/movierouter.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="hll"><span class="kr">const</span> <span class="p">{</span> <span class="nx">listAction</span><span class="p">,</span> <span class="nx">detailAction</span><span class="p">,</span> <span class="nx">createAction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>
</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">listAction</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="nx">detailAction</span><span class="p">);</span>
<span class="hll"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">createAction</span><span class="p">);</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Die Funktionen im Model haben alle den gleichen Aufbau. Es wird eine Promise erzeugt und mithilfe von <code>connection.query()</code> eine Anfrage an die Datenbank gestellt. Im Erfolgsfall wird die <code>resolve()</code>-Funktion der Promise aufgerufen, im Fehlerfall die <code>reject()</code>-Funktion. Im Controller wird der <code>request</code> verarbeitet und eine <code>response</code> erzeugt. Im Router werden die Endpunkte und die dazugehörigen HTTP-Methoden (z.B. <code>get</code> oder <code>post</code>) definiert. </p>
<p>Um die <code>createAction</code>-Funktion zu testen, rufen wir Postman auf und tragen in die URL <code>http://localhost:8080/movie/</code> ein. Wichtig: es muss nun <code>POST</code> ausgewählt werden. Mit dem Request übergeben wir im Body nun ein JSON, das einen neuen Film enthält, d.h. das JSON muss die Eigensc haften <code>title</code> und <code>year</code> enthalten (nicht <code>id</code>, denn diese wird automatisch durch das Datenbanksystem erzeugt). Die Anfrage sieht in Postman wie folgt aus:</p>
<p><img alt="POST" src="../files/38_postman_post.png" /></p>
<p>Es kann auch mit <code>curl</code> getestet werden:</p>
<div class="highlight"><pre><span></span><code>curl -X POST -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -d <span class="s1">&#39;{&quot;title&quot;: &quot;Noch ein Test&quot;, &quot;year&quot;: &quot;2019&quot;}&#39;</span> http://localhost:8080/movie 

<span class="o">{</span><span class="s2">&quot;fieldCount&quot;</span>:0,<span class="s2">&quot;affectedRows&quot;</span>:1,<span class="s2">&quot;insertId&quot;</span>:23,<span class="s2">&quot;serverStatus&quot;</span>:2,<span class="s2">&quot;warningCount&quot;</span>:0,<span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;protocol41&quot;</span>:true,<span class="s2">&quot;changedRows&quot;</span>:0<span class="o">}</span>
</code></pre></div>

<h4 id="put-einen-datensatz-andern">PUT - einen Datensatz ändern<a class="headerlink" href="#put-einen-datensatz-andern" title="Permanent link">&para;</a></h4>
<p>Das Ändern eines Datensatzes erfolgt in ähnlicher Weise wie das Anlegen eines Datensatzes. Es wird im Body der Anfrage das neue JSON gesendet und der <code>Content-Type</code> der Anfrage ist <code>application/json</code> (im Header gesetzt).</p>
<p>Zum Ändern eines Datensatzes wird die HTTP-Methode <code>put</code> verwendet. Um nun einen Datensatz in der Datenbank zu ändern, erweitern wir unser Projekt wie folgt:</p>
<ul>
<li>in <code>movie/model.js</code> wird eine <code>update()</code>-Funktion definiert, welche durch die <code>save()</code>-Funktion aufgerufen wird (<code>save()</code> wird nach außen zur Verfügung gestellt),</li>
<li>in <code>movie/controller.js</code> wird eine <code>updateAction()</code> definiert, die genauso aussieht wie die <code>createAction()</code>, außer dass die <code>id</code> aus der URL ausgelesen wird und nicht aus dem Request-Body </li>
<li>in <code>movie/movierouter.js</code> wird der neue Endpunkt <code>router.put('/', updateActionAction);</code> festgelegt</li>
</ul>
<div class="tabbed-set" data-tabs="18:3"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><label for="__tabbed_18_1">movie/model.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>   <span class="cm">/* hier muss Ihr Passwort hin */</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s1">&#39;movie-db&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span><span class="cm">/* bleibt so */</span> <span class="p">}</span>

<span class="hll"><span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">        <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;UPDATE Movies SET title = ?, year = ? WHERE id = ?&#39;</span><span class="p">;</span>
</span><span class="hll">        <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">[</span><span class="nx">movie</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span> <span class="nx">movie</span><span class="p">.</span><span class="nx">id</span><span class="p">],</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class="hll">            <span class="k">else</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
</span><span class="hll">        <span class="p">});</span>
</span><span class="hll">    <span class="p">});</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAll</span><span class="p">,</span>
    <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)},</span>
    <span class="nx">save</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">movie</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">movie</span><span class="p">);</span>
<span class="hll">        <span class="k">else</span> <span class="k">return</span> <span class="nx">update</span><span class="p">(</span><span class="nx">movie</span><span class="p">);</span>
</span>    <span class="p">},</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><label for="__tabbed_18_2">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>  
<span class="kd">function</span> <span class="nx">detailAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>  
<span class="kd">function</span> <span class="nx">createAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span><span class="cm">/* bleibt so */</span> <span class="p">}</span>  

<span class="hll"><span class="kd">function</span> <span class="nx">updateAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="kr">const</span> <span class="nx">movie</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">id</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">title</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">year</span><span class="o">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span>
</span><span class="hll">    <span class="p">};</span>
</span><span class="hll">    <span class="nx">model</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">movie</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span>
</span><span class="hll">        <span class="nx">movie</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">movie</span><span class="p">),</span>
</span><span class="hll">        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>
</span><span class="hll">    <span class="p">);</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
    <span class="nx">detailAction</span><span class="p">,</span>
    <span class="nx">createAction</span><span class="p">,</span>
<span class="hll">    <span class="nx">updateAction</span><span class="p">,</span>
</span><span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_18_3" name="__tabbed_18" type="radio" /><label for="__tabbed_18_3">movie/movierouter.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="hll"><span class="kr">const</span> <span class="p">{</span> <span class="nx">listAction</span><span class="p">,</span> <span class="nx">detailAction</span><span class="p">,</span> <span class="nx">createAction</span><span class="p">,</span> <span class="nx">updateAction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>
</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">listAction</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="nx">detailAction</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">createAction</span><span class="p">);</span>
<span class="hll"><span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="nx">updateAction</span><span class="p">);</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Um die Update-Funktion in Postman auszuprobieren, geben Sie als URL z.B. <code>http://localhost:8080/movie/3</code> ein (um den Film mit der <code>id=3</code> zu ändern) und wählen als HTTP-Methode <code>PUT</code>. Im Request-Body geben Sie dann z.B.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
   <span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Der Pate 3&quot;</span><span class="p">,</span>
   <span class="s2">&quot;year&quot;</span><span class="o">:</span><span class="s2">&quot;1990&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>ein. Sie erhalten:</p>
<p><img alt="PUT" src="../files/39_postman_put.png" /></p>
<p>Natürlich können Sie zum Testen auch <code>curl</code> verwenden. Die Anfrage ist ähnlich zur <code>POST</code>-Anfrage, nur mit <code>curl -X PUT</code>. </p>
<h4 id="delete-einen-datensatz-andern">DELETE - einen Datensatz ändern<a class="headerlink" href="#delete-einen-datensatz-andern" title="Permanent link">&para;</a></h4>
<p>Um einen Datensatz zu löschen, wählen wir die HTTP-Methode <code>DELETE</code>. Alles andere bleibt wie gehabt. Wir präsentieren gleich die Lösung:</p>
<div class="tabbed-set" data-tabs="19:3"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><label for="__tabbed_19_1">movie/model.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>   <span class="cm">/* hier muss Ihr Passwort hin */</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s1">&#39;movie-db&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>

<span class="hll"><span class="kd">function</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">        <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;DELETE FROM Movies WHERE id = ?&#39;</span><span class="p">;</span>
</span><span class="hll">        <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class="hll">            <span class="k">else</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class="hll">        <span class="p">});</span>
</span><span class="hll">    <span class="p">});</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAll</span><span class="p">,</span>
    <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">id</span><span class="p">)},</span>
    <span class="nx">save</span><span class="p">(</span><span class="nx">movie</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">movie</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">movie</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">return</span> <span class="nx">update</span><span class="p">(</span><span class="nx">movie</span><span class="p">);</span>
    <span class="p">},</span>
<span class="hll">    <span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">id</span><span class="p">)},</span>
</span><span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_19_2" name="__tabbed_19" type="radio" /><label for="__tabbed_19_2">movie/controller.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">listAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>  
<span class="kd">function</span> <span class="nx">detailAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>  
<span class="kd">function</span> <span class="nx">createAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* bleibt so */</span> <span class="p">}</span>  
<span class="kd">function</span> <span class="nx">updateAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span><span class="cm">/* bleibt so */</span> <span class="p">}</span>  
<span class="hll">
</span><span class="hll"><span class="kd">function</span> <span class="nx">deleteAction</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span><span class="hll">    <span class="nx">model</span>
</span><span class="hll">        <span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
</span><span class="hll">        <span class="p">.</span><span class="nx">then</span><span class="p">(</span>
</span><span class="hll">            <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span><span class="nx">send</span><span class="p">(),</span>
</span><span class="hll">            <span class="nx">error</span> <span class="p">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
</span><span class="hll">        <span class="p">);</span>
</span><span class="hll"><span class="p">}</span>
</span><span class="hll">
</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">listAction</span><span class="p">,</span>
    <span class="nx">detailAction</span><span class="p">,</span>
    <span class="nx">createAction</span><span class="p">,</span>
    <span class="nx">updateAction</span><span class="p">,</span>
<span class="hll">    <span class="nx">deleteAction</span>
</span><span class="p">};</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_19_3" name="__tabbed_19" type="radio" /><label for="__tabbed_19_3">movie/movierouter.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="hll"><span class="kr">const</span> <span class="p">{</span> <span class="nx">listAction</span><span class="p">,</span> <span class="nx">detailAction</span><span class="p">,</span> <span class="nx">createAction</span><span class="p">,</span> <span class="nx">updateAction</span><span class="p">,</span> <span class="nx">deleteAction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller&#39;</span><span class="p">);</span>
</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">listAction</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="nx">detailAction</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">createAction</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="nx">updateAction</span><span class="p">);</span>
<span class="hll"><span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="nx">deleteAction</span><span class="p">);</span>
</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Wir haben nun eine vollständige REST-Schnittstelle des Backends implementiert. Es können alle Datensätze oder ein Datensatz gelesen (<strong>read</strong> mithilfe von <code>get</code>), ein Datensatz erzeugt (<strong>create</strong> mithilfe von <code>post</code>), ein Datensatz aktualisiert (<strong>update</strong> mithilfe von <code>put</code>) und ein Datensatz gelöscht (<strong>delete</strong> mithilfe von <code>delete</code>) werden. </p>
</div>
<h3 id="json-web-tokens-zur-authentifizierung">JSON Web Tokens zur Authentifizierung<a class="headerlink" href="#json-web-tokens-zur-authentifizierung" title="Permanent link">&para;</a></h3>
<p>Unsere Backend-Schnittstelle ist bis jetzt offen für jeden, d.h. jeder, der die Endpunkte kennt, kann die Ressourcen abfragen und somit Daten auslesen, löschen, ändern usw. Das kann natürlich nicht richtig sein, insbesondere wenn mit sensiblen Daten gearbeitet wird. Wir können im Backend auch nicht ein Anmeldeformular vorsehen, da das Backend nur Services anbietet. Außerdem ist die Kommunikation mit der REST-Schnittstelle zustandslos, d.h. es kann gar nicht gespeichert werden, ob eine Nutzerin bereits angemeldet ist oder nicht. Eine Lösung für diese Probleme sind <a href="https://jwt.io/"><em>JSON Web Tokens (JWT)</em></a>. </p>
<p>Ein JWT ist eine codierte Zeichenkette, die einen Header enthält, einen Payload und eine Signatur. Hier ein Screenshot der jwt.io-Webseite mit einem Beispiel dafür:</p>
<p><img alt="JWT" src="../files/40_jwt.png" /></p>
<h4 id="datenbank-und-model">Datenbank und Model<a class="headerlink" href="#datenbank-und-model" title="Permanent link">&para;</a></h4>
<p>Wir erzeugen zunächst eine Tabelle in unserer Datenbank, um Nutzername und zugehöriges Passwort zu speichern.</p>
<h4 id="erzeugen-eines-jwt">Erzeugen eines JWT<a class="headerlink" href="#erzeugen-eines-jwt" title="Permanent link">&para;</a></h4>
<p>Für die Erzeugung eines JWT verwenden wir das Nodes-Paket <code>jsonwebtoken</code>. Dieses installieren wir im Ordner <code>backend</code> mit dem Befehl </p>
<div class="highlight"><pre><span></span><code>npm install jsonwebtoken
</code></pre></div>

<p>Wir erstellen uns eine Route, über die die Benutzer ihre Anmeldedaten an das Backend schicken können</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Die Bezeichnung <code>movierouter.js</code> für diese Datei ist hier noch verwirrend, da sie zunächst auch die Daten enthalten wird. Wir werden nach und nach die Funktionen so gestalten und auslagern, dass die Datei nur noch den Router enthält und für alles andere ein Model, eine View und ein Controller entstehen werden.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Beachten Sie auch hier wieder, dass aus Gründen der Übersichtlichkeit die Daten in den Reiter <code>const data</code> ausgelagert wurden. Die müssen Sie hineinkopieren.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>Achten Sie darauf, Ihr korrektes Passwort einzutragen.&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>Wir werden die <code>save()</code>-Funktion später noch erweitern. Beim Anlegen eines neuen Datensatzes werden zwar der Titel und das Entstehungsjahr des Films mitgesendet, nicht jedoch die <code>id</code>. Die <code>id</code> wird durch das Datenbanksystems vergeben. Für den Fall, dass der <code>save()</code>-Funktion auch die <code>id</code> des Films mitgegeben wird, gehen wir davon aus, dass der Film in der Datenbank aktualisiert (<code>update()</code>) wird, sich also ein Eintrag geändert hat.&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="">
        
          <a href="../backendanbindung/" title="Frontend-Backend-Anbindung" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Zurück
                </span>
                Frontend-Backend-Anbindung
              </div>
            </div>
          </a>
        
        
          <a href="../books/" title="Bücher-App" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Weiter
                </span>
                Bücher-App
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Jörn Freiheit
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "In Zwischenablage kopieren", "clipboard.copied": "In Zwischenablage kopiert", "search.config.lang": "de", "search.config.pipeline": "", "search.config.separator": "", "search.result.placeholder": "Suchbegriff eingeben", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["instant", "tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>