


<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lehrmaterial, Übungen, Aufgaben und Hilfen für WebTech">
      
      
        <link rel="canonical" href="http://freiheit.f4.htw-berlin.de/webtech/jwt/">
      
      
        <meta name="author" content="Jörn Freiheit">
      
      <link rel="shortcut icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>JWT - WebTech</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#757575">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="" data-md-color-primary="grey" data-md-color-accent="indigo">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#json-web-tokens-jwt" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="">
    <a href="http://freiheit.f4.htw-berlin.de/webtech" title="WebTech" class="md-header-nav__button md-logo" aria-label="WebTech">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            WebTech
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              JWT
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suchbegriff eingeben
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/jfreiheit/webtech/" title="Quellcode" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="http://freiheit.f4.htw-berlin.de/webtech" title="WebTech" class="md-nav__button md-logo" aria-label="WebTech">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    WebTech
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jfreiheit/webtech/" title="Quellcode" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../uebungen/" title="Übungen" class="md-nav__link">
      Übungen
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tools/" title="Werkzeuge" class="md-nav__link">
      Werkzeuge
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../html/" title="HTML" class="md-nav__link">
      HTML
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../css/" title="CSS" class="md-nav__link">
      CSS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rwd/" title="RWD" class="md-nav__link">
      RWD
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../json/" title="JSON" class="md-nav__link">
      JSON
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../angular/" title="Angular" class="md-nav__link">
      Angular
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../material/" title="Material" class="md-nav__link">
      Material
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../backend/" title="REST-API" class="md-nav__link">
      REST-API
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../backendanbindung/" title="Frontend-Backend-Anbindung" class="md-nav__link">
      Frontend-Backend-Anbindung
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        JWT
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="JWT" class="md-nav__link md-nav__link--active">
      JWT
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#login-backend" class="md-nav__link">
    Login-Backend
  </a>
  
    <nav class="md-nav" aria-label="Login-Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-datenbank" class="md-nav__link">
    login-Datenbank
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-erzeugen" class="md-nav__link">
    Backend erzeugen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-testen" class="md-nav__link">
    Backend testen
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-frontend" class="md-nav__link">
    Login-Frontend
  </a>
  
    <nav class="md-nav" aria-label="Login-Frontend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#services-im-frontend" class="md-nav__link">
    Services im Frontend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registrierungs-komponente" class="md-nav__link">
    Registrierungs-Komponente
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-komponente" class="md-nav__link">
    Login-Komponente
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ausblick" class="md-nav__link">
    Ausblick
  </a>
  
    <nav class="md-nav" aria-label="Ausblick">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dowmloads-der-aktuellen-versionen" class="md-nav__link">
    Dowmloads der aktuellen Versionen
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zugriff-nur-bei-login" class="md-nav__link">
    Zugriff nur bei Login
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../node/" title="Node.js" class="md-nav__link">
      Node.js
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../books/" title="Bücher-App" class="md-nav__link">
      Bücher-App
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../books-backend/" title="Bücher-Backend" class="md-nav__link">
      Bücher-Backend
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#login-backend" class="md-nav__link">
    Login-Backend
  </a>
  
    <nav class="md-nav" aria-label="Login-Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-datenbank" class="md-nav__link">
    login-Datenbank
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-erzeugen" class="md-nav__link">
    Backend erzeugen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-testen" class="md-nav__link">
    Backend testen
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-frontend" class="md-nav__link">
    Login-Frontend
  </a>
  
    <nav class="md-nav" aria-label="Login-Frontend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#services-im-frontend" class="md-nav__link">
    Services im Frontend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registrierungs-komponente" class="md-nav__link">
    Registrierungs-Komponente
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-komponente" class="md-nav__link">
    Login-Komponente
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ausblick" class="md-nav__link">
    Ausblick
  </a>
  
    <nav class="md-nav" aria-label="Ausblick">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dowmloads-der-aktuellen-versionen" class="md-nav__link">
    Dowmloads der aktuellen Versionen
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zugriff-nur-bei-login" class="md-nav__link">
    Zugriff nur bei Login
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jfreiheit/webtech/edit/master/docs/jwt.md" title="Seite editieren" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="json-web-tokens-jwt">JSON Web Tokens (JWT)<a class="headerlink" href="#json-web-tokens-jwt" title="Permanent link">&para;</a></h1>
<p>Mithilfe von <a href="https://jwt.io/introduction">JSON Web Tokens (JWT)</a> verwalten wir den Zugriff auf Webseiten. Wir werden JWTs hier ganz einfach dafür verwenden, um zu unterscheiden, ob eine Nutzerin bereits eingeloggt ist oder nicht. Zunächst nochmal zur Wiederholung: HTTP ist ein <em>zustandsloses</em> Protokoll. Das bedeutet insbesondere, dass der Webserver vorherige Anfragen desselben Clients nirgendwo speichert und somit auch nicht kennt. </p>
<p>Prinzipiell ist es also gar nicht möglich, sich zunächst mit einer Anfrage beim Webserver einzuloggen und sich bei den folgenden Anfragen dann darauf zu beziehen. Eine Abhilfe dafür wird dadurch erreicht, dass der Webserver bei "Einloggen" ein <em>sicheres Token</em> generiert und dem Nutzer dieses Token übermittelt. Danach schickt der Nutzer dieses Token bei jeder Anfrage an den Webserver (im Header der Anfrage) mit. Der Webserver kann mithilfe dieses Tokens die Nutzerin identifizieren und eine eigene Historie über die Zugriffe anlegen, z.B. in einer Datenbank. Erst dadurch wird es möglich, dass man z.B. einen virtuellen Einkaufskorb befüllt.  </p>
<p>Ein JSON Web Token besteht aus drei Teilen:</p>
<ul>
<li>einem <em>Header</em>, der den Typ des Tokens enthält (<code>JWT</code>) und den Verschlüsselungsalgorithmus, der zur Verschlüsselung der Informationen verwendet wird, z.B. <a href="https://de.wikipedia.org/wiki/SHA-2"><code>SHA256</code></a>.  </li>
<li>einem <em>Paload</em>, der die Informationen über die Ntzerin enthält und eventuell weitere Informationen, wie z.B. Rolle der Nutzerin, z.B. <code>admin</code></li>
<li>einer <em>Signatur</em>, die mithilfe des angegebenen Verschlüsselungsalgorithmus die Inforationen des Headers und der Payload verschlüsselt. Mithilfe der Signatur kann überprüft werden, ob ide Informationen im Header oder im Payload geändert wurden oder nicht. </li>
</ul>
<p>Die drei Teile werden jeweils durch einen Punkt getrennt, d.h. ein JWT hat die Form <code>header.payload.signature</code>. </p>
<p>Mithilfe des <a href="https://jwt.io/#debugger-io">Codierers/De-Codierers</a> von JWT können Sie das Codieren bzw. Decodieren nachvollziehen. Angenommen, Ihr <em>Header</em> ist </p>
<div class="highlight"><pre><span></span><code>{
  &quot;alg&quot;: &quot;HS256&quot;,
  &quot;typ&quot;: &quot;JWT&quot;
}
</code></pre></div>

<p>, d.h. Sie verwenden <code>SHA256</code> zur Verschlüsselung und der Typ ist <code>JWT</code>. Dann ist der erste Teil des JWT</p>
<div class="highlight"><pre><span></span><code><span class="err">eyJhbGciOiJIUzI</span><span class="mi">1</span><span class="err">NiIsInR</span><span class="mi">5</span><span class="err">cCI</span><span class="mi">6</span><span class="err">IkpXVCJ</span><span class="mi">9</span>
</code></pre></div>

<p>Angenommen, Ihr <em>Payload</em> ist </p>
<div class="highlight"><pre><span></span><code>{
  &quot;data&quot;: [
    {
      &quot;id&quot;: 1,
      &quot;username&quot;: &quot;test&quot;,
      &quot;email&quot;: &quot;test@test.de&quot;,
      &quot;password&quot;: &quot;098f6bcd4621d373cade4e832627b4f6&quot;
    }
  ],
  &quot;iat&quot;: 1609061622
}
</code></pre></div>

<p>Die <code>data</code> haben die gleiche Struktur, wie wir sie später auch verwenden werden. Das Passwort <code>test</code> ist <code>md5</code>-verschlüsselt. <code>iat</code> steht für <em>issued at</em>  und gibt die Zeit (<a href="https://www.unixtimestamp.com/index.php">Unix-Time</a>) an, zu der das JWT erzeugt wurde (hier 27.12.2020). Dann ist der zweite Teil des JWT</p>
<div class="highlight"><pre><span></span><code><span class="err">eyJkYXRhIjpbeyJpZCI</span><span class="mi">6</span><span class="err">MSwidXNlcm</span><span class="mi">5</span><span class="err">hbWUiOiJ</span><span class="mi">0</span><span class="err">ZXN</span><span class="mi">0</span><span class="err">IiwiZW</span><span class="mi">1</span><span class="err">haWwiOiJ</span><span class="mi">0</span><span class="err">ZXN</span><span class="mi">0</span><span class="err">QHRlc</span><span class="mi">3</span><span class="err">QuZGUiLCJwYXNzd</span><span class="mi">29</span><span class="err">yZCI</span><span class="mi">6</span><span class="err">IjA</span><span class="mi">5</span><span class="err">OGY</span><span class="mi">2</span><span class="err">YmNkNDYyMWQzNzNjYWRlNGU</span><span class="mi">4</span><span class="err">MzI</span><span class="mi">2</span><span class="err">MjdiNGY</span><span class="mi">2</span><span class="err">In</span><span class="mi">1</span><span class="err">dLCJpYXQiOjE</span><span class="mi">2</span><span class="err">MDkwNjE</span><span class="mi">2</span><span class="err">MjJ</span><span class="mi">9</span>
</code></pre></div>

<p>Wenn Sie als "sichere" Passpharse <code>secret</code> wählen und damit die <em>Signatur</em> erstellen, dann ist der dritet Teil des JWT</p>
<div class="highlight"><pre><span></span><code><span class="err">XBWOvX</span><span class="mi">8</span><span class="err">OceGmx</span><span class="mi">8</span><span class="err">u</span><span class="mi">77</span><span class="err">YfsyQtupYYO</span><span class="mi">9</span><span class="err">p</span><span class="mi">9</span><span class="err">mUurvIqqwgdk</span>
</code></pre></div>

<p>Sie werden diesen JWT (andere Zeit) später in Ihrer Anwendung wiederfinden. Ausführliche Informationen über JWT finden Sie <a href="https://jwt.io">hier</a>.</p>
<p>Wir werden JWT hier in der einfachsten Form anwenden:</p>
<ul>
<li>wir können uns registrieren und einloggen</li>
<li>das Backend erzeugt beim Registrieren ein JWT und schickt es an den Client</li>
<li>im Client speichern wir das JWT ab und verwenden es dann beim Zugriff auf die Webseite</li>
</ul>
<h2 id="login-backend">Login-Backend<a class="headerlink" href="#login-backend" title="Permanent link">&para;</a></h2>
<p>Wir erstellen ein Backend mit dem folgenden Endpunkten: </p>
<table>
<thead>
<tr>
<th> Methode</th>
<th> URL</th>
<th> Bedeutung</th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>POST</code></td>
<td> <code>/user/register</code></td>
<td> Registrierung - fügt einen neuen Datensatz hinzu</td>
</tr>
<tr>
<td><code>POST</code></td>
<td> <code>/user/login</code></td>
<td> Login - prüft, ob ein Nutzer in der Datenbank enthalten ist</td>
</tr>
</tbody>
</table>
<p>Für das Registrieren wird ein JSON in der folgenden Form (Beispieldaten) an das Backend gesendet:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test@test.de&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Für das Login wird die E-Mail-Adresse weggelassen und nur <code>username</code> und <code>password</code> übermittelt:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Existiert der Nutzer <code>test</code> mit dem Passwort <code>test</code> in der Datenbank, so wird das folgende JSON vom Backend zum Frontend zurückgesendet:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test@test.de&quot;</span><span class="p">,</span>
            <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;098f6bcd4621d373cade4e832627b4f6&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjpbeyJpZCI6MSwidXNlcm5hbWUiOiJ0ZXN0IiwiZW1haWwiOiJ0ZXN0QHRlc3QuZGUiLCJwYXNzd29yZCI6IjA5OGY2YmNkNDYyMWQzNzNjYWRlNGU4MzI2MjdiNGY2In1dLCJpYXQiOjE2MDkwODIyMTF9.ou22aTCkagg_0hchSdO_dV5AHUDizPqp287dAUOpues&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Das Passwort wird nicht als Klarname in der Datenbank abgelegt, sondern verschlüsselt (als <em>Hash</em>) durch das <a href="https://www.npmjs.com/package/md5"><code>md5</code>-Modul</a>.</p>
<h3 id="login-datenbank"><code>login</code>-Datenbank<a class="headerlink" href="#login-datenbank" title="Permanent link">&para;</a></h3>
<p>Unter <code>localhost/phpmyadmin</code> (oder auf dem <code>studi.f4</code>-Server) eine Datenbank erstellen (z.B. <code>login</code>). Darin eine Tabelle <code>users</code> anlegen:</p>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">SQL-Query zum Erstellen der Tabelle `users`</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="c1">--</span>
<span class="c1">-- Tabellenstruktur für Tabelle `users`</span>
<span class="c1">--</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">users</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">email</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8mb4_0900_ai_ci</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Indizes für die Tabelle `users`</span>
<span class="c1">--</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">users</span><span class="o">`</span>
  <span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">);</span>
</code></pre></div>

</div>
</div>
<h3 id="backend-erzeugen">Backend erzeugen<a class="headerlink" href="#backend-erzeugen" title="Permanent link">&para;</a></h3>
<p>Wir erzeugen uns ein Backend namens <code>loginbackend</code>: </p>
<div class="highlight"><pre><span></span><code>mkdir loginbackend 
<span class="nb">cd</span> loginbackend 
npm init 
</code></pre></div>

<p>Nun installieren wir gleich alle <code>node</code>-Module, die wir im Backend benötigen:</p>
<div class="highlight"><pre><span></span><code>npm install express --save
npm install nodemon
npm install cors
npm install mysql
npm install jsonwebtoken
npm install md5
</code></pre></div>

<p>Als erstes erstellen wir eine neue Datei <code>app.js</code> und geben ein:</p>
<div class="tabbed-set" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">app.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">index_router</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./controller/index&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">())</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">index_router</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;listening on port 4000&#39;</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>In Zeile <code>2</code> wird eine <code>controller/index.js</code> verwendet. Erzeugen Sie einen Ordner <code>controller</code> und darin eine <code>index.js</code>:</p>
<div class="tabbed-set" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">controller/index.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../model/user&#39;</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>In Zeile <code>3</code> wird eine <code>model/user.js</code> verwendet. Erzeugen Sie einen Ordner <code>model</code> und darin eine <code>user.js</code>:</p>
<div class="tabbed-set" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">model/user.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">md5</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jsonwebtoken&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">con</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s2">&quot;IhrPasswort&quot;</span><span class="p">,</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s2">&quot;login&quot;</span>
<span class="p">});</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">hashed_password</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">password</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
        <span class="kr">const</span> <span class="nx">checkUsername</span> <span class="o">=</span> <span class="sb">`Select username FROM users WHERE username = ?`</span><span class="p">;</span>
        <span class="nx">con</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">checkUsername</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
                <span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`Insert Into users (username, email, password) VALUES ( ?, ?, ? )`</span>
                <span class="nx">con</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
                    <span class="nx">sql</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">hashed_password</span><span class="p">],</span>
                    <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">=&gt;{</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
                            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">err</span> <span class="p">});</span>
                        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                            <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span> <span class="p">},</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span>
                            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">token</span> <span class="o">:</span> <span class="nx">token</span> <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">hashed_password</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">password</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
        <span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`SELECT * FROM users WHERE username = ? AND password = ?`</span>
        <span class="nx">con</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
            <span class="nx">sql</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">hashed_password</span><span class="p">],</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">fields</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">err</span> <span class="p">});</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span> <span class="p">},</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">token</span><span class="o">:</span> <span class="nx">token</span> <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">})</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Diese Datei ist recht umfangreich. Wir schauen uns die Details gleich näher an. Zunächst passen wir noch die <code>package.json</code> an, um mithilfe von <code>nodemon</code> unsere Anwendung zu starten (unter <code>script</code>):</p>
<div class="tabbed-set" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><label for="__tabbed_5_1">package.json</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;loginbackend&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="p">,</span>
<span class="hll">    <span class="nt">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;nodemon app.js&quot;</span>
</span>  <span class="p">},</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;cors&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.8.5&quot;</span><span class="p">,</span>
    <span class="nt">&quot;express&quot;</span><span class="p">:</span> <span class="s2">&quot;^4.17.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;jsonwebtoken&quot;</span><span class="p">:</span> <span class="s2">&quot;^8.5.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;md5&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.3.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;mysql&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.18.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;nodemon&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.0.6&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Starten Sie die Anwendung mit </p>
<div class="highlight"><pre><span></span><code>npm start
</code></pre></div>

<p>oder, noch besser, konfigurieren Sie das Ausführungskommando in Ihrer IDE, so dass Sie die Anwendung über den entsprechenden Button starten können: <img alt="start" src="../files/114_start.png" />.</p>
<p>Wir verwenden dieses Mal <code>nodemon</code> zum Start der Anwenung. Das hat den Vorteil, dass wir <code>node</code> nicht jedes Mal aufrufen müssen, um das Backend zu starten. <code>nodemon</code> ist noch nicht wirklich ausgetestet, funktioniert aber in den meisten Fällen schon recht gut, weshalb wir es hier ausprobieren. Es ist nur für die Entwicklung empfohlen. Das Backend sollte sich jetzt ausführen lassen. </p>
<h3 id="backend-testen">Backend testen<a class="headerlink" href="#backend-testen" title="Permanent link">&para;</a></h3>
<p>Wir testen das Backend mithilfe von Postman. Starten Sie das Backend und öffnen Sie Postman. Geben Sie als <code>POST</code>-Anfrage <code>http://localhost:4000/user/register</code> ein und senden Sie im <code>body</code> (als <code>JSON</code>) die Daten</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test@test.de&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>mit: </p>
<p><img alt="postman" src="../files/115_postman.png" /></p>
<p>Der User <code>test</code> wird mit den entsprechenden Informationen in der Datenbank abgelegt. Das Passwort ist dabei verschlüsselt. Die Response des Servers ist etwas in der Art: </p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;fieldCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;affectedRows&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;insertId&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;serverStatus&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nt">&quot;warningCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="nt">&quot;protocol41&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">&quot;changedRows&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="nt">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjpbeyJpZCI6MSwidXNlcm5hbWUiOiJ0ZXN0IiwiZW1haWwiOiJ0ZXN0QHRlc3QuZGUiLCJwYXNzd29yZCI6IjA5OGY2YmNkNDYyMWQzNzNjYWRlNGU4MzI2MjdiNGY2In1dLCJpYXQiOjE2MDkwNjE2MjJ9.XBWOvX8OceGmx8u77YfsyQtupYYO9p9mUurvIqqwgdk&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>In der Datenbank sehen Sie den Eintrag:</p>
<p><img alt="mysql" src="../files/117_mysql.png" /></p>
<p>Nach dem Registrieren können Sie auch das EInloggen testen. Geben Sie als <code>POST</code>-Anfrage <code>http://localhost:4000/user/login</code> ein und senden Sie im <code>body</code> (als <code>JSON</code>) die Daten</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>mit: </p>
<p><img alt="postman" src="../files/116_postman.png" /></p>
<p>Die Response hat die folgende Form:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test@test.de&quot;</span><span class="p">,</span>
            <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;098f6bcd4621d373cade4e832627b4f6&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjpbeyJpZCI6MSwidXNlcm5hbWUiOiJ0ZXN0IiwiZW1haWwiOiJ0ZXN0QHRlc3QuZGUiLCJwYXNzd29yZCI6IjA5OGY2YmNkNDYyMWQzNzNjYWRlNGU4MzI2MjdiNGY2In1dLCJpYXQiOjE2MDkwNjE2MjJ9.XBWOvX8OceGmx8u77YfsyQtupYYO9p9mUurvIqqwgdk&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Das Backend erzwugt den JWT bei jedem Login neu. Es gibt also ein <em>Session-JWT</em>. Eine andere Möglichkeit wäre, das JWT beim Registrieren zu erzeugen und eebenfalls in der Datenbank abzuspeichern und es dann immer mitzuschicken. </p>
<p>Wir schauen uns nun nochmal die <code>user.js</code> genauer an:</p>
<div class="tabbed-set" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><label for="__tabbed_6_1">model/user.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">md5</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jsonwebtoken&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">con</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s2">&quot;IhrPasswort&quot;</span><span class="p">,</span>
    <span class="nx">database</span><span class="o">:</span> <span class="s2">&quot;login&quot;</span>
<span class="p">});</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">hashed_password</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">password</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
        <span class="kr">const</span> <span class="nx">checkUsername</span> <span class="o">=</span> <span class="sb">`Select username FROM users WHERE username = ?`</span><span class="p">;</span>
        <span class="nx">con</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">checkUsername</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
                <span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`Insert Into users (username, email, password) VALUES ( ?, ?, ? )`</span>
                <span class="nx">con</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
                    <span class="nx">sql</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">hashed_password</span><span class="p">],</span>
                    <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">fields</span><span class="p">)</span> <span class="p">=&gt;{</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
                            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">err</span> <span class="p">});</span>
                        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                            <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span> <span class="p">},</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span>
                            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">token</span> <span class="o">:</span> <span class="nx">token</span> <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">hashed_password</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">password</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
        <span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="sb">`SELECT * FROM users WHERE username = ? AND password = ?`</span>
        <span class="nx">con</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
            <span class="nx">sql</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">hashed_password</span><span class="p">],</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">fields</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">err</span> <span class="p">});</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span> <span class="p">},</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">token</span><span class="o">:</span> <span class="nx">token</span> <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">})</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">error</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>In den Zeilen <code>6-11</code> definieren wir den Zugang zur Datenbank. Achten Sie hier auf das richtige Passwort und den korrekten Namen der Datenbank. In den zeilen <code>12-35</code> wird die <em>Registrierungs</em>-Funktion definiert und in den zeilen <code>37-55</code> die <em>Login</em>-Funktion. </p>
<p>In der Registrierungsfunktion wird zunächst überprüft, ob der <code>username</code> bereits in der Datenbank existiert (Zeilen <code>16-17</code>). Wenn nicht, wird der Nutzer in der Datenbank angelegt (Zeilen <code>19-20</code>) und das JWT wird erzeugt (Zeile <code>26</code>). Die Daten und das JWT werden vom Backend zusammen mit dem <code>status: 1</code> als Response zurückgeschickt, wenn alles fehlerlos geklappt hat. Beachten Sie, dass beim Erstellen des JWT als "sichere" Passphrase das Wort <code>secret</code> verwendet wird  (Zeile <code>26</code>). Das Pasowrt wird mittels <code>md5</code> gehasht - es wird also verschlüsselt abgelegt (Zeile <code>15</code>). </p>
<p>Die Login-Funktion ist der Registrierungs-Funktion sehr ähnlich. Es wird der passende <code>username</code> in der Datenbank gesucht und das gehashte Passowrt verglichen. Auch hier wird ein JWT erzeugt. </p>
<h2 id="login-frontend">Login-Frontend<a class="headerlink" href="#login-frontend" title="Permanent link">&para;</a></h2>
<p>Für das Frontend erstellen wir uns ein Formular zur Registrierung und ein Formular für das Login. Das JWT, das wir vom Webserver erhalten, speichern wir lokal ab. Dazu verwenden wir <code>localStorage</code>. Wir nennen unser Frontend <code>loginfrontend</code>:</p>
<div class="highlight"><pre><span></span><code>ng new loginfrontend 
</code></pre></div>

<p>Wir erzeugen uns zwei Komponenten, eine für die Registrierung und die andere für das Login:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> loginfrontend 
ng g c login 
ng g c register 
</code></pre></div>

<p>Wir binden beide Komponenten über Routing ein. In der <code>app-routing.module.ts</code> definieren wir dazu:</p>
<div class="tabbed-set" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><label for="__tabbed_7_1">app-module.routing.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Routes</span><span class="p">,</span> <span class="nx">RouterModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">LoginComponent</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./login/login.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">RegisterComponent</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./register/register.component&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">routes</span><span class="o">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
<span class="hll">  <span class="p">{</span><span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nx">component</span><span class="o">:</span> <span class="nx">LoginComponent</span><span class="p">},</span>
</span><span class="hll">  <span class="p">{</span><span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="nx">component</span><span class="o">:</span> <span class="nx">RegisterComponent</span><span class="p">},</span>
</span><span class="p">];</span>

<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">)],</span>
  <span class="nx">exports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppRoutingModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Damit die Formulare schicker aussehen, binden wir Bootstrap ein:</p>
<div class="highlight"><pre><span></span><code>npm install --save bootstrap
npm install --save jquery
npm install --save popper.js
</code></pre></div>

<p>In der <code>angular.json</code> Bootstrap hinzufügen:</p>
<div class="tabbed-set" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><label for="__tabbed_8_1">angular.json (Auszug)</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="s2">&quot;assets&quot;</span><span class="err">:</span> <span class="p">[</span>
  <span class="s2">&quot;src/favicon.ico&quot;</span><span class="p">,</span>
  <span class="s2">&quot;src/assets&quot;</span>
<span class="p">]</span><span class="err">,</span>
<span class="s2">&quot;styles&quot;</span><span class="err">:</span> <span class="p">[</span>
<span class="hll">  <span class="s2">&quot;./node_modules/bootstrap/dist/css/bootstrap.css&quot;</span><span class="p">,</span>
</span>  <span class="s2">&quot;src/styles.css&quot;</span>
<span class="p">]</span><span class="err">,</span>
<span class="s2">&quot;scripts&quot;</span><span class="err">:</span> <span class="p">[</span>
<span class="hll">  <span class="s2">&quot;./node_modules/jquery/dist/jquery.js&quot;</span><span class="p">,</span>
</span><span class="hll">  <span class="s2">&quot;./node_modules/bootstrap/dist/js/bootstrap.js&quot;</span>
</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Die Zeilen müssen zwei Mal eingefügt werden. Einmal unter <code>"build"</code> und einmal unter <code>"test"</code>. Achten Sie darauf, zunächst <code>jQuery</code> einzubinden und erst dann <code>bootstrap.js</code>. </p>
<h3 id="services-im-frontend">Services im Frontend<a class="headerlink" href="#services-im-frontend" title="Permanent link">&para;</a></h3>
<p>Wir erstellen uns zwei Services. Der eine Service <code>api</code> ist für die Kommunikation mit dem Backend zuständig. Der andere Service <code>auth</code> legt den Token im <code>localStorage</code> ab und holt ihn auch von dort. </p>
<div class="highlight"><pre><span></span><code>ng g service services/auth
ng g service services/api 
</code></pre></div>

<p>In der <code>services/api.service.ts</code>:</p>
<div class="tabbed-set" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><label for="__tabbed_9_1">services/api.service.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../environments/environment&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpClient</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">map</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">ApiService</span> <span class="p">{</span>
  <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:4000/&#39;</span><span class="p">;</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">http</span><span class="o">:</span> <span class="nx">HttpClient</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">postTypeRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span><span class="o">:</span> <span class="nx">any</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}${</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="nx">payload</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>In der <code>services/auth.service.ts</code>:</p>
<div class="tabbed-set" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><label for="__tabbed_10_1">services/auth.service.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AuthService</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">getUserDetails</span><span class="p">()</span><span class="o">:</span> <span class="nx">any</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;userData&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;userData&#39;</span><span class="p">))</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">setDataInLocalStorage</span><span class="p">(</span><span class="nx">variableName</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span><span class="o">:</span> <span class="nx">any</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">variableName</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">clearStorage</span><span class="p">()</span><span class="o">:</span> <span class="nx">any</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Mit der <code>getUserDetails()</code>-Funktion laden wir die <code>userData</code> aus dem <code>localStorage</code>, mit der <code>setDataInLocalStorage()</code>-Funktion speichern wir die <code>userData</code> im <code>localStorage</code> und <code>clearStorage()</code> löscht den gesamten <code>localStorage</code>. </p>
<h3 id="registrierungs-komponente">Registrierungs-Komponente<a class="headerlink" href="#registrierungs-komponente" title="Permanent link">&para;</a></h3>
<p>In der Registrierungskomponente erstellen wir das Formular zur Registrierung und rufen mit den eingebgebenen Daten das Backend zur Registrierung auf. </p>
<p>In der <code>register.component.ts</code>: </p>
<div class="tabbed-set" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><label for="__tabbed_11_1">src/app/register/register.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ApiService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../services/api.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../services/auth.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">FormGroup</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-register&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./register.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./register.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">RegisterComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="nx">isLogin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">errorMessage</span><span class="p">;</span>
  <span class="nx">registerForm</span><span class="o">:</span> <span class="nx">FormGroup</span><span class="p">;</span>
  <span class="nx">submitted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">formBuilder</span><span class="o">:</span> <span class="nx">FormBuilder</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">api</span><span class="o">:</span> <span class="nx">ApiService</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">auth</span><span class="o">:</span> <span class="nx">AuthService</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">router</span><span class="o">:</span> <span class="nx">Router</span>
  <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="c1">// convenience getter for easy access to form fields</span>
  <span class="nx">get</span> <span class="nx">f</span><span class="p">()</span><span class="o">:</span> <span class="nx">any</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">controls</span><span class="p">;</span> <span class="p">}</span>

  <span class="nx">ngOnInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">formBuilder</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
      <span class="nx">username</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
      <span class="nx">email</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
      <span class="nx">password</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isUserLogin</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">onSubmit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">submitted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Your form data : &#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">postTypeRequest</span><span class="p">(</span><span class="s1">&#39;user/register&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">res</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">setDataInLocalStorage</span><span class="p">(</span><span class="s1">&#39;userData&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">setDataInLocalStorage</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">navigate</span><span class="p">([</span><span class="s1">&#39;login&#39;</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">errorMessage</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">isUserLogin</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">getUserDetails</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isLogin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Im Konstruktor (Zeilen <code>18-23</code>) werden die beiden Services, der <code>FormBuilder</code> und das <code>Router</code>-Modul per dependency injection eingebunden. In der <code>ngOnInit()</code>-Funktion (Zeilen <code>28-35</code>) definieren wir das Formular bestehend aus den <code>FormControls</code> <code>username</code>, <code>email</code> und <code>password</code>. Das gesamte Formular ist in der Eigenschaft <code>registerForm</code> gespeichert (Zeile <code>15</code>). Für den Zugriff auf die einzelnen <code>FormControls</code> defineiren wir noch einen Getter <code>f()</code>, der uns Schreibarbeit in der <code>register.component.html</code> erspart (<code>f()</code> gibt uns ein Objekt der drei <code>FormControls</code> des Formulars zurück). </p>
<p>Die Funktion <code>onSubmit()</code> wird aufgerufen, wenn das Formular abgeschickt wird. In Zeile <code>39</code> geben wir die Daten des Formulars auf die Konsole aus (nur für Debug-Zwecke). In den Zeilen <code>40-52</code> rufen wir die Funktion <code>postTypeRequest</code> aus unserem <code>api</code>-Service auf. Darin übergeben wir alle Daten aus dem Formular. Wenn alles klappt (<code>status</code> der Response ist <code>1</code>), dann speichern wir alle Daten lokal unter <code>userData</code> (Zeile <code>43</code>) und das JWT nochmal extra unter <code>token</code> (Zeile <code>44</code>). Danach rufen wir die Route <code>login</code> auf, wechseln also zur Login-Komponente. </p>
<p>Das Template der Registrierungs-Komponente sieht wie folgt aus:</p>
<div class="tabbed-set" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><label for="__tabbed_12_1">src/app/register/register.component.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;row m-0 w-100&#39;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;col-md-4 offset-4 mt-5&#39;</span> <span class="err">*</span><span class="na">ngIf </span><span class="o">=</span> <span class="s">&#39;!this.isLogin&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>Register<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&quot;</span><span class="na">registerForm</span><span class="err">&quot;</span> <span class="err">(</span><span class="na">ngSubmit</span><span class="err">)=&quot;</span><span class="na">onSubmit</span><span class="err">()&quot;</span> <span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-group&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-control&#39;</span> <span class="na">type </span><span class="o">=</span> <span class="s">&quot;text&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">name </span><span class="o">=</span> <span class="s">&quot;username&quot;</span> <span class="na">placeholder </span><span class="o">=</span> <span class="s">&quot;Username&quot;</span> <span class="err">[</span><span class="na">ngClass</span><span class="err">]=&quot;{</span> <span class="err">&#39;</span><span class="na">is-invalid</span><span class="err">&#39;</span><span class="na">:</span> <span class="na">submitted</span> <span class="err">&amp;&amp;</span> <span class="na">f</span><span class="err">.</span><span class="na">username</span><span class="err">.</span><span class="na">errors</span> <span class="err">}&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;submitted &amp;&amp; f.username.errors&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;invalid-feedback&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;f.username.errors.required&quot;</span><span class="p">&gt;</span>Username is required<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-group&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-control&#39;</span> <span class="na">type </span><span class="o">=</span> <span class="s">&quot;email&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">name </span><span class="o">=</span> <span class="s">&quot;email&quot;</span> <span class="na">placeholder </span><span class="o">=</span> <span class="s">&quot;Email&quot;</span> <span class="err">[</span><span class="na">ngClass</span><span class="err">]=&quot;{</span> <span class="err">&#39;</span><span class="na">is-invalid</span><span class="err">&#39;</span><span class="na">:</span> <span class="na">submitted</span> <span class="err">&amp;&amp;</span> <span class="na">f</span><span class="err">.</span><span class="na">email</span><span class="err">.</span><span class="na">errors</span> <span class="err">}&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;submitted &amp;&amp; f.email.errors&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;invalid-feedback&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;f.email.errors.required&quot;</span><span class="p">&gt;</span>E-Mail is required<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-group&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-control&#39;</span> <span class="na">type </span><span class="o">=</span> <span class="s">&quot;password&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name </span><span class="o">=</span> <span class="s">&quot;password&quot;</span> <span class="na">placeholder </span><span class="o">=</span> <span class="s">&quot;Password&quot;</span> <span class="err">[</span><span class="na">ngClass</span><span class="err">]=&quot;{</span> <span class="err">&#39;</span><span class="na">is-invalid</span><span class="err">&#39;</span><span class="na">:</span> <span class="na">submitted</span> <span class="err">&amp;&amp;</span> <span class="na">f</span><span class="err">.</span><span class="na">password</span><span class="err">.</span><span class="na">errors</span> <span class="err">}&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;submitted &amp;&amp; f.password.errors&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;invalid-feedback&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;f.password.errors.required&quot;</span><span class="p">&gt;</span>Password is required<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span> <span class="s">&#39;btn btn-outline-info&#39;</span> <span class="na">type </span><span class="o">=</span> <span class="s">&quot;submit&quot;</span> <span class="na">value </span><span class="o">=</span> <span class="s">&quot;Register&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;col-md-4 offset-4 mt-5&#39;</span> <span class="err">*</span><span class="na">ngIf </span><span class="o">=</span> <span class="s">&#39;this.isLogin&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>You are logged in<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Die Direktive <code>*ngIf = '!this.isLogin'</code> in Zeile <code>2</code> prüft den Status der Eigenschaft <code>isLogin</code>. Diese ist am Angang <code>false</code> (siehe <code>register.component.ts</code> in Zeile <code>13</code>). Durch die <code>isUserLogin()</code>-Funktion der <code>register.component.ts</code> (Zeilen <code>55-59</code>) kann der Wert auf <code>true</code> gesetzt werden, wenn der <code>auth</code>-Service <code>userData</code> gespeichert hat. Für den Fall. dass <code>isLogin</code> den Wert <code>true</code> hat, zeigt die Registrierungs-Komponente <code>You are logged in</code> an (Zeilen <code>26-28</code>). Wenn nicht, erscheint das Registrierungsformular (Zeilen <code>2-25</code>). Beim Absenden des Formulars wird die <code>onSubmit()</code>-Funktion aus <code>register.component.ts</code> aufgerufen. Für die einzelnen Eingabefelder wird ein Atrributbinding definiert: Falls das Formular abgeschickt wurde (<code>submitted</code>) und aber Fehler existieren (z.B. <code>f.username.errors</code>), wird dem entsprechenden Eingabefeld die Bootstrap-Klasse <code>is-invalid</code> zugeordnet und es erscheint die darunter definierte Fehlerausgabe. Hier findet auch die <code>f()</code>-Funktion ihre Anwendung. </p>
<h3 id="login-komponente">Login-Komponente<a class="headerlink" href="#login-komponente" title="Permanent link">&para;</a></h3>
<p>Die Login-Komponente hat starke Ähnlichkeit mit der Registrierungs-Komponente. Das Formular enthält jedoch keinen Eintrag für die E-Mail und es wird eine ander URL im Backend aufgerufen <code>user/login</code> anstelle von <code>user/rgister</code>. Außerdem stellt die Login-Komponente noch einen Button <code>Log-out</code> zur Verfügung, der ein Ausloggen ermöglicht (<code>logout()</code>-Funktion). Das Ausloggen wird hier dadurch simuliert, dass der <code>localStorage</code> gelöscht wird. Ansonsten sehen sich swohl die <code>ts</code>- als auch die <code>html</code>-Datei sehr ähnlich: </p>
<div class="tabbed-set" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><label for="__tabbed_13_1">src/app/login/login.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">FormGroup</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ApiService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../services/api.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./../services/auth.service&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-login&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./login.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./login.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">LoginComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="nx">isLogin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">errorMessage</span><span class="p">;</span>
  <span class="nx">loginForm</span><span class="o">:</span> <span class="nx">FormGroup</span><span class="p">;</span>
  <span class="nx">submitted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">formBuilder</span><span class="o">:</span> <span class="nx">FormBuilder</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">api</span><span class="o">:</span> <span class="nx">ApiService</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">auth</span><span class="o">:</span> <span class="nx">AuthService</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">router</span><span class="o">:</span> <span class="nx">Router</span>
  <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">ngOnInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loginForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">formBuilder</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
      <span class="nx">username</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
      <span class="nx">password</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isUserLogin</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// convenience getter for easy access to form fields</span>
  <span class="nx">get</span> <span class="nx">f</span><span class="p">()</span><span class="o">:</span> <span class="nx">any</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginForm</span><span class="p">.</span><span class="nx">controls</span><span class="p">;</span> <span class="p">}</span>

  <span class="nx">onSubmit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">submitted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Your form data : &#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginForm</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">postTypeRequest</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginForm</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">res</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">setDataInLocalStorage</span><span class="p">(</span><span class="s1">&#39;userData&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">setDataInLocalStorage</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">navigate</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">errorMessage</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">isUserLogin</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">getUserDetails</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">getUserDetails</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isLogin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">logout</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">clearStorage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">navigate</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</div>
<input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><label for="__tabbed_13_2">src/app/login/login.component.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;row m-0 w-100&#39;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;col-md-4 offset-4 mt-5&#39;</span> <span class="err">*</span><span class="na">ngIf </span><span class="o">=</span> <span class="s">&#39;!this.isLogin&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&quot;</span><span class="na">loginForm</span><span class="err">&quot;</span> <span class="err">(</span><span class="na">ngSubmit</span><span class="err">)=&quot;</span><span class="na">onSubmit</span><span class="err">()&quot;</span> <span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-group&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-control&#39;</span> <span class="na">type </span><span class="o">=</span> <span class="s">&quot;text&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">name </span><span class="o">=</span> <span class="s">&quot;username&quot;</span> <span class="na">placeholder </span><span class="o">=</span> <span class="s">&quot;Username&quot;</span> <span class="err">[</span><span class="na">ngClass</span><span class="err">]=&quot;{</span> <span class="err">&#39;</span><span class="na">is-invalid</span><span class="err">&#39;</span><span class="na">:</span> <span class="na">submitted</span> <span class="err">&amp;&amp;</span> <span class="na">f</span><span class="err">.</span><span class="na">username</span><span class="err">.</span><span class="na">errors</span> <span class="err">}&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;submitted &amp;&amp; f.username.errors&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;invalid-feedback&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;f.username.errors.required&quot;</span><span class="p">&gt;</span>Username is required<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-group&#39;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;form-control&#39;</span> <span class="na">type </span><span class="o">=</span> <span class="s">&quot;password&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name </span><span class="o">=</span> <span class="s">&quot;password&quot;</span> <span class="na">placeholder </span><span class="o">=</span> <span class="s">&quot;Password&quot;</span> <span class="err">[</span><span class="na">ngClass</span><span class="err">]=&quot;{</span> <span class="err">&#39;</span><span class="na">is-invalid</span><span class="err">&#39;</span><span class="na">:</span> <span class="na">submitted</span> <span class="err">&amp;&amp;</span> <span class="na">f</span><span class="err">.</span><span class="na">password</span><span class="err">.</span><span class="na">errors</span> <span class="err">}&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;submitted &amp;&amp; f.password.errors&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;invalid-feedback&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;f.password.errors.required&quot;</span><span class="p">&gt;</span>Password is required<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span> <span class="s">&#39;btn btn-outline-info&#39;</span> <span class="na">type </span><span class="o">=</span> <span class="s">&quot;submit&quot;</span> <span class="na">value </span><span class="o">=</span> <span class="s">&quot;Login&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;col-md-4 offset-4 mt-5&#39;</span> <span class="err">*</span><span class="na">ngIf </span><span class="o">=</span> <span class="s">&#39;this.isLogin&#39;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>You are logged in<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class </span><span class="o">=</span> <span class="s">&#39;btn btn-outline-info&#39;</span> <span class="err">(</span><span class="na">click</span><span class="err">)</span> <span class="err">=</span> <span class="err">&#39;</span><span class="na">logout</span><span class="err">()&#39;</span><span class="p">&gt;</span>Log-out<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Die <code>app.component.html</code> können Sie sich gestalten, wie Sie möchten. Eine Möglichkeit wäre so:</p>
<div class="tabbed-set" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><label for="__tabbed_14_1">app.component.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-light bg-light&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="err">[</span><span class="na">routerLink</span><span class="err">]</span> <span class="err">=</span> <span class="err">&quot;[&#39;/&#39;]&quot;</span> <span class="na">routerLinkActive </span><span class="o">=</span> <span class="s">&quot;active&quot;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">data-toggle</span><span class="o">=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-target</span><span class="o">=</span><span class="s">&quot;#navbarNav&quot;</span> <span class="na">aria-controls</span><span class="o">=</span><span class="s">&quot;navbarNav&quot;</span> <span class="na">aria-expanded</span><span class="o">=</span><span class="s">&quot;false&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Toggle navigation&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler-icon&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;navbarNav&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link&quot;</span> <span class="err">[</span><span class="na">routerLink</span><span class="err">]</span> <span class="err">=</span> <span class="err">&quot;[&#39;</span><span class="na">login</span><span class="err">&#39;]&quot;</span> <span class="na">routerLinkActive </span><span class="o">=</span> <span class="s">&quot;active&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link&quot;</span> <span class="err">[</span><span class="na">routerLink</span><span class="err">]</span> <span class="err">=</span> <span class="err">&quot;[&#39;</span><span class="na">register</span><span class="err">&#39;]&quot;</span> <span class="na">routerLinkActive </span><span class="o">=</span> <span class="s">&quot;active&quot;</span> <span class="p">&gt;</span>Register<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">router-outlet</span><span class="p">&gt;&lt;/</span><span class="nt">router-outlet</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>

</div>
</div>
<p>Die entsprechenden Seiten sehen dann so aus:</p>
<p><img alt="jwt" src="../files/121_login.png" /></p>
<h2 id="ausblick">Ausblick<a class="headerlink" href="#ausblick" title="Permanent link">&para;</a></h2>
<p>Beachten Sie, dass das Beispiel bewusst einfach gehalten wurde. Es fehlen mehrere Sachen:</p>
<ul>
<li>wir reagieren im Frontend gar nicht auf Fehler des Backends, d.h. es fehlen z.B.<ul>
<li>Reaktionen beim Registrieren, falls der <code>username</code> bereits existiert,</li>
<li>Reaktionen beim Login, falls das Passwort nicht korrekt ist</li>
</ul>
</li>
<li>wir haben keine Zugriffssteuerung definiert, d.h. es fehlt noch eine Seite (Komponente), auf die nur dann zugegriffen werden kann, wenn der Nutzer eingeloggt ist</li>
</ul>
<p>Die Fehlerpunkte wären sicherlich eine gute Übung für Sie. Den letzten Punkt betrachten wir beim nächsten Mal. Allerdings kann man JWT auch noch so erweitern, dass bestimmte Rollen hinterlegt und abgefraget werden können. Das werden wir uns nicht anschauen. Aber vielleicht haben Sie ja bereits selbst Ideen, wie das geschehen kann. Die Nutzerdaten müssten ja nur im ein Attribut <code>role</code> erweitert und abgefragt werden. Umfassende Informationen darüber finden Sie im <a href="../files/jwt-handbook-v0_14_1.pdf">JWT-Handbuch</a>.</p>
<h3 id="dowmloads-der-aktuellen-versionen">Dowmloads der aktuellen Versionen<a class="headerlink" href="#dowmloads-der-aktuellen-versionen" title="Permanent link">&para;</a></h3>
<p>Clonen von Github:</p>
<ul>
<li><a href="https://github.com/jfreiheit/loginfrontend">loginfrontend</a></li>
<li><a href="https://github.com/jfreiheit/loginbackend">loginbackend</a></li>
</ul>
<p>im Folgenden wird auf diesen Versionen aufgebaut. </p>
<h2 id="zugriff-nur-bei-login">Zugriff nur bei Login<a class="headerlink" href="#zugriff-nur-bei-login" title="Permanent link">&para;</a></h2>
<p>UserService</p>
<div class="highlight"><pre><span></span><code>ng g s services/user
</code></pre></div>

<p>UserComponent</p>
<div class="highlight"><pre><span></span><code>ng g c user
</code></pre></div>

<p><a href="https://swagger.io/docs/specification/authentication/bearer-authentication/">Bearer Authentication</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="">
        
          <a href="../backendanbindung/" title="Frontend-Backend-Anbindung" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Zurück
                </span>
                Frontend-Backend-Anbindung
              </div>
            </div>
          </a>
        
        
          <a href="../node/" title="Node.js" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Weiter
                </span>
                Node.js
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Jörn Freiheit
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "In Zwischenablage kopieren", "clipboard.copied": "In Zwischenablage kopiert", "search.config.lang": "de", "search.config.pipeline": "", "search.config.separator": "", "search.result.placeholder": "Suchbegriff eingeben", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["instant", "tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>